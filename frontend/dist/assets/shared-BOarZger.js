var L=Object.defineProperty,T=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var N=(t,e,s)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,f=(t,e)=>{for(var s in e||(e={}))A.call(e,s)&&N(t,s,e[s]);if(w)for(var s of w(e))_.call(e,s)&&N(t,s,e[s]);return t},p=(t,e)=>T(t,P(e));var S=(t,e)=>{var s={};for(var r in t)A.call(t,r)&&e.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&w)for(var r of w(t))e.indexOf(r)<0&&_.call(t,r)&&(s[r]=t[r]);return s};var g=(t,e,s)=>N(t,typeof e!="symbol"?e+"":e,s);var y=(t,e,s)=>new Promise((r,a)=>{var o=n=>{try{i(s.next(n))}catch(l){a(l)}},c=n=>{try{i(s.throw(n))}catch(l){a(l)}},i=n=>n.done?r(n.value):Promise.resolve(n.value).then(o,c);i((s=s.apply(t,e)).next())});import{j as jsxRuntimeExports,r as reactExports,e as useLocation,i as React,L as Link,k as MapContainer,T as TileLayer,l as useMap,G as GeoJSON,g as useParams,f as useNavigate,m as ReactDOM}from"./react-vendor-CXQW5CXM.js";import{c as clsx,aj as lookup}from"./vendor-C2xFHkO2.js";import"./map-vendor--2Gvwj5Q.js";import{u as useFieldDetail}from"./feature-fields-2FR36cYB.js";import{a as axios}from"./http-vendor-DnTtldoj.js";const Card=c=>{var i=c,{title:t,status:e="default",showStatusStripe:s=!1,className:r,children:a}=i,o=S(i,["title","status","showStatusStripe","className","children"]);const n=e==="excellent"?"bg-status-excellent":e==="fair"?"bg-status-fair":e==="poor"?"bg-status-poor":"bg-transparent";return jsxRuntimeExports.jsxs("section",p(f({className:clsx("relative flex rounded-lg border border-gray-100 bg-white shadow-sm","focus-within:ring-2 focus-within:ring-brand-blue focus-within:ring-offset-2",r)},o),{children:[s&&e!=="default"&&jsxRuntimeExports.jsx("div",{className:clsx("w-1 rounded-l-lg",n),"aria-hidden":"true"}),jsxRuntimeExports.jsxs("div",{className:clsx("flex-1 p-4 sm:p-5",s&&e!=="default"&&"ml-0"),children:[t&&jsxRuntimeExports.jsx("h2",{className:"text-sm font-semibold text-gray-900 mb-2","aria-label":t,children:t}),jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-700",children:a})]})]}))},PageContainer=a=>{var o=a,{fullWidth:t,className:e,children:s}=o,r=S(o,["fullWidth","className","children"]);const c="w-full px-4 sm:px-6 lg:px-8 py-4 sm:py-6",i=t?"mx-auto":"mx-auto max-w-page";return jsxRuntimeExports.jsx("div",p(f({className:clsx(c,i,e)},r),{children:s}))},getEnvConfig=()=>{try{const meta=eval("import.meta.env");return{API_BASE_URL:(meta==null?void 0:meta.VITE_API_BASE_URL)||"/api/v1",MODE:(meta==null?void 0:meta.MODE)||"development",IS_DEV:(meta==null?void 0:meta.DEV)===!0,IS_PROD:(meta==null?void 0:meta.PROD)===!0}}catch(t){return{API_BASE_URL:"/api/v1",MODE:"development",IS_DEV:!1,IS_PROD:!1}}},env=getEnvConfig();class ApiError extends Error{constructor(s,r,a,o){super(s);g(this,"status");g(this,"code");g(this,"details");this.name="ApiError",this.status=r,this.code=a,this.details=o!=null?o:null}}const authState={tokens:{accessToken:null,refreshToken:null},isRefreshing:!1,refreshPromise:null,refreshFn:null,onAuthError:null},setAuthTokens=t=>{var e;authState.tokens={accessToken:t.accessToken,refreshToken:(e=t.refreshToken)!=null?e:null}},configureAuthHandlers=t=>{var e,s;authState.refreshFn=(e=t.refreshFn)!=null?e:null,authState.onAuthError=(s=t.onAuthError)!=null?s:null},apiBaseURL=env.API_BASE_URL,httpClient=axios.create({baseURL:apiBaseURL,withCredentials:!1});httpClient.interceptors.request.use(t=>(authState.tokens.accessToken&&t.headers&&(t.headers.Authorization=`Bearer ${authState.tokens.accessToken}`),t));httpClient.interceptors.response.use(t=>t,t=>y(void 0,null,function*(){var o;const e=t.config,s=(o=t.response)==null?void 0:o.status;if(!e)return Promise.reject(normalizeApiError(t));const r=s===401,a=!!(authState.refreshFn&&authState.tokens.refreshToken);if(!r||!a)return r&&authState.onAuthError&&authState.onAuthError(),Promise.reject(normalizeApiError(t));if(e._retry)return authState.onAuthError&&authState.onAuthError(),Promise.reject(normalizeApiError(t));e._retry=!0;try{authState.isRefreshing||(authState.isRefreshing=!0,authState.refreshPromise=authState.refreshFn(authState.tokens).then(n=>(authState.isRefreshing=!1,authState.refreshPromise=null,!n||!n.accessToken?null:(setAuthTokens(n),n))).catch(()=>(authState.isRefreshing=!1,authState.refreshPromise=null,null)));const c=yield authState.refreshPromise;if(!c||!c.accessToken)return authState.onAuthError&&authState.onAuthError(),Promise.reject(normalizeApiError(t));const i=e;return i.headers||(i.headers={}),i.headers.Authorization=`Bearer ${c.accessToken}`,httpClient(i)}catch(c){return authState.onAuthError&&authState.onAuthError(),Promise.reject(normalizeApiError(t))}}));const normalizeApiError=t=>{var e,s,r,a,o,c,i,n;if(t instanceof ApiError)return t;if(axios.isAxiosError(t)){const l=t,u=(e=l.response)==null?void 0:e.status,m=(s=l.response)==null?void 0:s.data,d=(r=m==null?void 0:m.error)==null?void 0:r.code,h=(c=(o=(a=m==null?void 0:m.error)==null?void 0:a.message)!=null?o:l.message)!=null?c:u?`Request failed with status ${u}`:"Request failed";return new ApiError(h,u,d,(n=(i=m==null?void 0:m.error)==null?void 0:i.details)!=null?n:null)}return t instanceof Error?new ApiError(t.message):new ApiError("An unexpected error occurred")},ToastContext=reactExports.createContext(void 0),DEFAULT_DURATION=4e3,ToastProvider=({children:t})=>{const[e,s]=reactExports.useState([]),r=reactExports.useCallback(i=>{s(n=>n.filter(l=>l.id!==i))},[]),a=reactExports.useCallback(()=>{s([])},[]),o=reactExports.useCallback(i=>{var u;const n=`${Date.now()}-${Math.random().toString(36).slice(2)}`,l=f({id:n,duration:(u=i.duration)!=null?u:DEFAULT_DURATION},i);s(m=>[...m,l]),l.duration&&l.duration>0&&window.setTimeout(()=>r(n),l.duration)},[r]),c=reactExports.useMemo(()=>({toasts:e,showToast:o,dismissToast:r,clearToasts:a}),[e,o,r,a]);return jsxRuntimeExports.jsxs(ToastContext.Provider,{value:c,children:[t,jsxRuntimeExports.jsxs("section",{"aria-label":"Toast notifications",className:"fixed z-50 top-4 right-4 flex flex-col gap-2 max-w-sm",children:[jsxRuntimeExports.jsx("h2",{className:"sr-only",children:"Toast notifications"}),e.map(i=>jsxRuntimeExports.jsx(Toast,{toast:i,onDismiss:()=>r(i.id)},i.id))]})]})},variantClasses={default:"bg-gray-900 text-white",success:"bg-status-excellent text-white",error:"bg-status-poor text-white",warning:"bg-status-fair text-gray-900"},Toast=({toast:t,onDismiss:e})=>{const{title:s,description:r,variant:a="default"}=t,o=a==="error",c=o?"alert":"status",i=o?"assertive":"polite";return jsxRuntimeExports.jsxs("div",{role:c,"aria-live":i,className:clsx("flex items-start gap-3 rounded-md shadow-lg px-4 py-3 text-sm focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-brand-blue",variantClasses[a]),children:[jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[s&&jsxRuntimeExports.jsx("p",{className:"font-medium",children:s}),r&&jsxRuntimeExports.jsx("p",{className:"mt-0.5 text-xs opacity-90",children:r})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:e,className:"ml-2 inline-flex h-8 w-8 items-center justify-center rounded-full border border-white/30 text-xs font-medium hover:bg-white/10 focus-visible:outline-none","aria-label":"Dismiss notification",children:"Ã—"})]})},useToastContext=()=>{const t=reactExports.useContext(ToastContext);if(!t)throw new Error("useToastContext must be used within a ToastProvider");return t},useToast=()=>{const{showToast:t,dismissToast:e,clearToasts:s,toasts:r}=useToastContext(),a=reactExports.useCallback(o=>{t(o)},[t]);return{toasts:r,showToast:a,dismissToast:e,clearToasts:s}},routesConfig={public:[{id:"auth.login",path:"/auth/login",label:"Login",breadcrumbLabel:"Sign in"},{id:"auth.register",path:"/auth/register",label:"Register",breadcrumbLabel:"Create account"},{id:"auth.resetPassword",path:"/auth/reset-password",label:"Reset password"}],farmer:[{id:"dashboard",path:"/dashboard",label:"Dashboard",isProtected:!0},{id:"fields.list",path:"/fields",label:"Fields",isProtected:!0},{id:"fields.create",path:"/fields/create",label:"Create field",isProtected:!0,breadcrumbLabel:"Add field"},{id:"fields.detail",path:"/fields/:fieldId",label:"Field details",isProtected:!0},{id:"fields.health",path:"/fields/:fieldId/health",label:"Health",breadcrumbLabel:"Field health",isProtected:!0},{id:"fields.recommendations",path:"/fields/:fieldId/recommendations",label:"Recommendations",breadcrumbLabel:"Field recommendations",isProtected:!0},{id:"fields.weather",path:"/fields/:fieldId/weather",label:"Weather",breadcrumbLabel:"Field weather",isProtected:!0},{id:"fields.editBoundary",path:"/fields/:fieldId/edit-boundary",label:"Edit boundary",breadcrumbLabel:"Edit boundary",isProtected:!0},{id:"weather.overview",path:"/weather",label:"Weather",isProtected:!0}],admin:[{id:"admin.overview",path:"/admin",label:"Admin",breadcrumbLabel:"Admin overview",isProtected:!0,roles:["admin"]},{id:"admin.users",path:"/admin/users",label:"Users",breadcrumbLabel:"User management",isProtected:!0,roles:["admin"]},{id:"admin.content",path:"/admin/content",label:"Content",breadcrumbLabel:"Content management",isProtected:!0,roles:["admin"]},{id:"admin.systemHealth",path:"/admin/system-health",label:"System health",breadcrumbLabel:"System health",isProtected:!0,roles:["admin"]}]},allRoutes=[...routesConfig.public,...routesConfig.farmer,...routesConfig.admin],findRouteByPath=t=>{const e=t==="/"?t:t.replace(/\/+$/,"");return allRoutes.find(s=>s.path===e)},useBreadcrumbs=()=>{const t=useLocation();return React.useMemo(()=>{var o,c;const{pathname:e}=t;if(e==="/"||e==="/dashboard"){const i=allRoutes.find(n=>n.path==="/dashboard");return[{label:(c=(o=i==null?void 0:i.breadcrumbLabel)!=null?o:i==null?void 0:i.label)!=null?c:"Dashboard",path:"/dashboard",isCurrent:!0,route:i}]}const s=e.split("/").filter(Boolean),r=[];let a="";return s.forEach((i,n)=>{var h;a+=`/${i}`;const l=findRouteByPath(a),u=(h=l==null?void 0:l.breadcrumbLabel)!=null?h:l==null?void 0:l.label,m=i.startsWith(":")?i.slice(1):i.charAt(0).toUpperCase()+i.slice(1),d=n===s.length-1;r.push({label:u!=null?u:m,path:a,isCurrent:d,route:l})}),r},[t])},Breadcrumbs=({items:t})=>t.length?jsxRuntimeExports.jsx("nav",{"aria-label":"Breadcrumb",className:"mb-3 text-xs sm:text-sm",children:jsxRuntimeExports.jsx("ol",{className:"flex flex-wrap items-center gap-1 text-gray-500",children:t.map((e,s)=>s===t.length-1?jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-1 text-gray-900 font-medium",children:[s>0&&jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:"/"}),jsxRuntimeExports.jsx("span",{"aria-current":"page",children:e.label})]},e.path):jsxRuntimeExports.jsxs("li",{className:"flex items-center gap-1",children:[s>0&&jsxRuntimeExports.jsx("span",{"aria-hidden":"true",children:"/"}),jsxRuntimeExports.jsx(Link,{to:e.path,className:"text-gray-500 hover:text-gray-900 hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2 rounded-sm px-0.5",children:e.label})]},e.path))})}):null,Button=u=>{var m=u,{variant:t="primary",size:e="md",fullWidth:s=!1,as:r="button",href:a,target:o,rel:c,className:i,children:n}=m,l=S(m,["variant","size","fullWidth","as","href","target","rel","className","children"]);var C,I;const d="inline-flex items-center justify-center rounded-md font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed transition-colors",h={sm:"text-xs px-3 h-9",md:"text-sm px-4 h-11",lg:"text-base px-5 h-12"},j={primary:"bg-brand-blue text-white hover:bg-blue-600",secondary:"bg-white text-gray-900 border border-gray-200 hover:bg-gray-50",ghost:"bg-transparent text-gray-900 hover:bg-gray-100",destructive:"bg-status-poor text-white hover:bg-red-600"},b=s?"w-full":"",k=l,{type:x}=k,E=S(k,["type"]),v=clsx(d,h[e],j[t],b,i);if(r==="a"){const R=E;return jsxRuntimeExports.jsx("a",p(f({href:a,target:o,rel:c,role:(C=R.role)!=null?C:"button",tabIndex:(I=R.tabIndex)!=null?I:0,className:v},R),{children:n}))}return jsxRuntimeExports.jsx("button",p(f({type:x!=null?x:"button",className:v},E),{children:n}))},SATELLITE_TILES={url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"&copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:18},DEFAULT_TILE_PROVIDER=SATELLITE_TILES,SRI_LANKA_CENTER={lat:7.9403,lng:81.0188};function MapReadyHandler({onReady:t}){const e=useMap();return reactExports.useEffect(()=>{t&&e&&t(e)},[e,t]),null}const BaseMap=({center:t,zoom:e=14,onMapReady:s,children:r,className:a="h-full w-full",scrollWheelZoom:o=!0})=>jsxRuntimeExports.jsxs(MapContainer,{center:t,zoom:e,className:a,zoomControl:!1,scrollWheelZoom:o,style:{height:"100%",width:"100%"},children:[jsxRuntimeExports.jsx(TileLayer,{url:DEFAULT_TILE_PROVIDER.url,attribution:DEFAULT_TILE_PROVIDER.attribution,maxZoom:DEFAULT_TILE_PROVIDER.maxZoom}),r,jsxRuntimeExports.jsx(MapReadyHandler,{onReady:s})]}),getFieldColor=t=>t.healthStatus&&{excellent:"#059669",good:"#10B981",fair:"#F59E0B",poor:"#EF4444"}[t.healthStatus]||"#3B82F6",FieldBoundaryLayer=({fields:t,selectedFieldId:e,onFieldClick:s})=>!t||t.length===0?null:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:t.map(r=>{const a=e===r.id,o=getFieldColor(r),c={color:o,weight:a?3:2,fillOpacity:a?.4:.3,fillColor:o},i={weight:3,fillOpacity:.5};return jsxRuntimeExports.jsx(GeoJSON,{data:r.boundary,style:c,eventHandlers:{click:()=>{s&&s(r.id)},mouseover:n=>{n.target.setStyle(i)},mouseout:n=>{n.target.setStyle(c)}}},r.id)})}),MapControls=({onCenterOnUser:t,showLocationButton:e=!0})=>{const s=useMap(),r=()=>{s.zoomIn()},a=()=>{s.zoomOut()};return jsxRuntimeExports.jsxs("div",{className:"absolute top-4 right-4 z-[1000] flex flex-col gap-2",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[jsxRuntimeExports.jsx(Button,{onClick:r,variant:"secondary",size:"sm",className:"rounded-b-none border-b w-10 h-10 p-0 text-xl","aria-label":"Zoom in",title:"Zoom in",children:"+"}),jsxRuntimeExports.jsx(Button,{onClick:a,variant:"secondary",size:"sm",className:"rounded-t-none w-10 h-10 p-0 text-xl","aria-label":"Zoom out",title:"Zoom out",children:"âˆ’"})]}),e&&t&&jsxRuntimeExports.jsx(Button,{onClick:t,variant:"secondary",size:"sm",className:"bg-white shadow-lg w-10 h-10 p-0","aria-label":"Center on my location",title:"Center on my location",children:"ðŸ“"})]})},useMapCenter=()=>{const[t,e]=reactExports.useState(SRI_LANKA_CENTER),[s,r]=reactExports.useState(!1),[a,o]=reactExports.useState(null);return{center:t,setCenter:e,getUserLocation:()=>{if(!navigator.geolocation){o("Geolocation is not supported by your browser");return}r(!0),o(null),navigator.geolocation.getCurrentPosition(i=>{e({lat:i.coords.latitude,lng:i.coords.longitude}),r(!1)},i=>{let n="Unable to retrieve your location";switch(i.code){case i.PERMISSION_DENIED:n="Location permission denied. Please enable location access.";break;case i.POSITION_UNAVAILABLE:n="Location information unavailable.";break;case i.TIMEOUT:n="Location request timed out.";break}o(n),r(!1),console.warn("Geolocation error:",n)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},loading:s,error:a}},calculatePolygonCenter=t=>{var o;if(t.type==="MultiPolygon"){const c=(o=t.coordinates[0])==null?void 0:o[0];if(!c||c.length===0)return{lat:7.9403,lng:81.0188};let i=0,n=0;const l=c.length;return c.forEach(u=>{const[m,d]=u;i+=d,n+=m}),{lat:i/l,lng:n/l}}const e=t.coordinates[0];if(!e||e.length===0)return{lat:7.9403,lng:81.0188};let s=0,r=0;const a=e.length;return e.forEach(c=>{const[i,n]=c;s+=n,r+=i}),{lat:s/a,lng:r/a}},calculatePolygonArea=t=>{var c;const e=t.type==="Polygon"?t.coordinates[0]:(c=t.coordinates[0])==null?void 0:c[0];if(!e||e.length<4)return 0;let s=0;for(let i=0;i<e.length-1;i++){const[n,l]=e[i],[u,m]=e[i+1];s+=n*m-u*l}s=Math.abs(s)/2;const r=111.32;return s*r*r*Math.cos(7*Math.PI/180)*100},fieldKeys={all:["fields"],list:t=>["fields","list",t],detail:t=>["fields","detail",t]},healthKeys={field:(t,e)=>["health",t,e],indices:["health","indices"]},recommendationKeys={field:t=>["recommendations",t]},weatherKeys={forecast:(t,e)=>["weather","forecast",{lat:t,lon:e}],alerts:["weather","alerts"]},yieldKeys={forecast:t=>["yield","forecast",t],history:t=>["yield","history",t]},dashboardKeys={metrics:["dashboard","metrics"]},adminKeys={users:t=>["admin","users",t],content:t=>["admin","content",t],systemStatus:["admin","systemStatus"]},Spinner=()=>jsxRuntimeExports.jsx("span",{className:"inline-flex h-4 w-4 items-center justify-center rounded-full border-2 border-gray-300 border-t-brand-blue animate-spin","aria-hidden":"true"}),LoadingState=o=>{var c=o,{message:t="Loadingâ€¦",description:e,compact:s,className:r}=c,a=S(c,["message","description","compact","className"]);const i=e?"loading-description":void 0;return s?jsxRuntimeExports.jsxs("div",p(f({className:clsx("inline-flex items-center gap-2 text-sm text-gray-600",r),role:"status","aria-live":"polite","aria-busy":"true","aria-describedby":i},a),{children:[jsxRuntimeExports.jsx(Spinner,{}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{children:t}),e&&jsxRuntimeExports.jsx("span",{id:i,className:"text-xs text-gray-500",children:e})]})]})):jsxRuntimeExports.jsx(Card,{className:clsx("flex items-center justify-center",r),children:jsxRuntimeExports.jsxs("div",p(f({className:"flex items-center gap-3 text-sm text-gray-700",role:"status","aria-live":"polite","aria-busy":"true","aria-describedby":i},a),{children:[jsxRuntimeExports.jsx(Spinner,{}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:t}),e&&jsxRuntimeExports.jsx("span",{id:i,className:"mt-0.5 text-xs text-gray-600",children:e})]})]}))})},ErrorIcon=()=>jsxRuntimeExports.jsx("span",{className:"inline-flex h-5 w-5 items-center justify-center rounded-full bg-status-poor/10 text-status-poor","aria-hidden":"true",children:jsxRuntimeExports.jsx("svg",{className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M10 2a8 8 0 1 0 .001 16.001A8 8 0 0 0 10 2Zm0 4a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-1.5 0v-4.5A.75.75 0 0 1 10 6Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z",clipRule:"evenodd"})})}),ErrorState=i=>{var n=i,{title:t="Something went wrong",message:e,onRetry:s,retryLabel:r="Retry",compact:a,className:o}=n,c=S(n,["title","message","onRetry","retryLabel","compact","className"]);const l=e?"error-state-description":void 0;return a?jsxRuntimeExports.jsxs("div",p(f({className:clsx("inline-flex items-center gap-2 text-sm text-red-700",o),role:"alert","aria-live":"assertive","aria-describedby":l},c),{children:[jsxRuntimeExports.jsx(ErrorIcon,{}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:t}),e&&jsxRuntimeExports.jsx("span",{id:l,className:"text-xs text-red-600",children:e})]}),s&&jsxRuntimeExports.jsx(Button,{type:"button",size:"sm",variant:"secondary",className:"ml-2",onClick:s,"aria-label":r,children:r})]})):jsxRuntimeExports.jsxs(Card,{className:clsx("flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",o),children:[jsxRuntimeExports.jsxs("div",p(f({className:"flex items-start gap-3 text-sm text-gray-800",role:"alert","aria-live":"assertive","aria-describedby":l},c),{children:[jsxRuntimeExports.jsx(ErrorIcon,{}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:t}),e&&jsxRuntimeExports.jsx("span",{id:l,className:"mt-0.5 text-xs text-gray-700",children:e})]})]})),s&&jsxRuntimeExports.jsx("div",{className:"flex items-center justify-end",children:jsxRuntimeExports.jsx(Button,{type:"button",size:"sm",variant:"secondary",onClick:s,"aria-label":r,children:r})})]})},FieldMapView=({fieldId:t,showHealthOverlay:e=!0,additionalFields:s=[],onFieldClick:r})=>{var b;const a=useParams(),o=t!=null?t:a.fieldId,{center:c,getUserLocation:i}=useMapCenter(),{data:n,isLoading:l,isError:u,error:m,refetch:d}=useFieldDetail(o!=null?o:""),h=reactExports.useMemo(()=>{if(n!=null&&n.geometry){const x=calculatePolygonCenter(n.geometry);return[x.lat,x.lng]}return[c.lat,c.lng]},[n,c]),j=reactExports.useMemo(()=>{const x=[];return n!=null&&n.geometry&&x.push({id:n.id,name:n.name,boundary:n.geometry,area:n.areaHa,healthStatus:n.latestHealthStatus}),x.push(...s),x},[n,s]);return l?jsxRuntimeExports.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900",children:jsxRuntimeExports.jsx(LoadingState,{message:"Loading map data..."})}):u?jsxRuntimeExports.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900 p-6",children:jsxRuntimeExports.jsx(ErrorState,{title:"Unable to load map",message:(b=m==null?void 0:m.message)!=null?b:"Failed to load field data for map display",onRetry:d})}):n?jsxRuntimeExports.jsxs("div",{className:"h-full w-full relative",children:[jsxRuntimeExports.jsxs(BaseMap,{center:h,zoom:15,children:[jsxRuntimeExports.jsx(FieldBoundaryLayer,{fields:j,selectedFieldId:o,onFieldClick:r}),jsxRuntimeExports.jsx(MapControls,{onCenterOnUser:i})]}),jsxRuntimeExports.jsxs("div",{className:"absolute top-4 left-4 z-[1000] bg-white/95 backdrop-blur-sm rounded-lg shadow-lg px-4 py-3 max-w-xs",children:[jsxRuntimeExports.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500 mb-1",children:"Current Field"}),jsxRuntimeExports.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-1",children:n.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-600",children:[n.areaHa.toFixed(2)," hectares"]}),n.centroidLatLon&&jsxRuntimeExports.jsxs("p",{className:"text-[10px] text-gray-500 mt-1 font-mono",children:[n.centroidLatLon.lat.toFixed(5),", ",n.centroidLatLon.lon.toFixed(5)]})]})]}):jsxRuntimeExports.jsx("div",{className:"h-full w-full flex items-center justify-center bg-gray-900",children:jsxRuntimeExports.jsxs("div",{className:"text-center text-white/70 max-w-md px-4",children:[jsxRuntimeExports.jsx("div",{className:"mb-4 text-4xl",children:"ðŸ—ºï¸"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"No field selected. Select a field to view its location on the map."})]})})},getInitialOnlineStatus=()=>{var t;return typeof window=="undefined"||typeof navigator=="undefined"?!0:(t=navigator.onLine)!=null?t:!0},useOnlineStatus=()=>{const[t,e]=reactExports.useState(()=>getInitialOnlineStatus());return reactExports.useEffect(()=>{if(typeof window=="undefined")return;const s=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",s),window.addEventListener("offline",r),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",r)}},[]),{isOnline:t}},NOTIFICATION_STORAGE_KEY="skycrop_notifications",PREFERENCES_STORAGE_KEY="skycrop_notification_preferences",MAX_STORED_NOTIFICATIONS=50,DEFAULT_PREFERENCES={enabled:!1,types:{"health-alert":!0,"weather-warning":!0,recommendation:!0,"yield-update":!0,system:!0,general:!1},doNotDisturb:!1,quietHoursStart:"22:00",quietHoursEnd:"07:00",soundEnabled:!0,vibrationEnabled:!0},TYPE_ICONS={"health-alert":"ðŸš¨","weather-warning":"ðŸŒ§ï¸",recommendation:"ðŸ¤–","yield-update":"ðŸ“Š",system:"âš™ï¸",general:"ðŸ“°"};class NotificationService{constructor(){g(this,"preferences");g(this,"notificationQueue",[]);this.preferences=this.loadPreferences()}isSupported(){return"Notification"in window}getPermission(){return this.isSupported()?Notification.permission:"denied"}requestPermission(){return y(this,null,function*(){if(!this.isSupported())throw new Error("Notifications not supported in this browser");if(this.getPermission()==="granted")return"granted";try{const e=yield Notification.requestPermission();return e==="granted"&&(this.preferences.enabled=!0,this.savePreferences(),this.send({type:"system",priority:"low",title:"ðŸŽ‰ Notifications Enabled!",body:"You'll now receive important alerts about your fields."})),e}catch(e){return console.error("Error requesting notification permission:",e),"denied"}})}send(e){return y(this,null,function*(){if(!this.canSendNotification(e))return console.log("Notification blocked by preferences:",e.type),null;if(this.isQuietHours()&&e.priority!=="critical")return console.log("Notification queued (quiet hours):",e.title),this.queueNotification(e),null;const s=this.storeNotification(e);try{const r=yield this.createBrowserNotification(e);return this.emitNotificationEvent(s),r}catch(r){return console.error("Error sending notification:",r),null}})}sendBatch(e){return y(this,null,function*(){for(const s of e)yield this.send(s),yield new Promise(r=>setTimeout(r,500))})}createBrowserNotification(e){return y(this,null,function*(){const s=f({body:e.body,icon:e.icon||this.getDefaultIcon(e.type),badge:e.badge,data:e.data,tag:e.tag||`${e.type}-${Date.now()}`,requireInteraction:e.requireInteraction||e.priority==="critical",vibrate:this.preferences.vibrationEnabled?[200,100,200]:void 0,silent:!this.preferences.soundEnabled},e.image&&{image:e.image}),r=new Notification(e.title,s);return r.onclick=()=>{window.focus(),r.close(),e.url?window.location.href=e.url:e.fieldId&&(window.location.href=`/fields/${e.fieldId}`)},r})}canSendNotification(e){return!(this.getPermission()!=="granted"||!this.preferences.enabled||this.preferences.doNotDisturb&&e.priority!=="critical"||!this.preferences.types[e.type])}isQuietHours(){if(!this.preferences.quietHoursStart||!this.preferences.quietHoursEnd)return!1;const e=new Date,s=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,r=this.preferences.quietHoursStart,a=this.preferences.quietHoursEnd;return r>a?s>=r||s<=a:s>=r&&s<=a}queueNotification(e){this.notificationQueue.push(e),this.notificationQueue.length>10&&this.notificationQueue.shift()}processQueue(){return y(this,null,function*(){if(this.notificationQueue.length===0)return;console.log(`Processing ${this.notificationQueue.length} queued notifications`);const e=[...this.notificationQueue];this.notificationQueue=[];for(const s of e)yield this.send(s)})}storeNotification(e){const s=p(f({},e),{id:e.id||`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:e.timestamp||Date.now(),read:!1,dismissed:!1}),r=this.getStoredNotifications();r.unshift(s);const a=r.slice(0,MAX_STORED_NOTIFICATIONS);return localStorage.setItem(NOTIFICATION_STORAGE_KEY,JSON.stringify(a)),s}getStoredNotifications(){try{const e=localStorage.getItem(NOTIFICATION_STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Error reading stored notifications:",e),[]}}markAsRead(e){const s=this.getStoredNotifications(),r=s.find(a=>a.id===e);r&&(r.read=!0,localStorage.setItem(NOTIFICATION_STORAGE_KEY,JSON.stringify(s)),this.emitNotificationEvent(r))}markAllAsRead(){const e=this.getStoredNotifications();e.forEach(s=>s.read=!0),localStorage.setItem(NOTIFICATION_STORAGE_KEY,JSON.stringify(e)),this.emitNotificationEvent(null)}dismissNotification(e){const s=this.getStoredNotifications(),r=s.find(a=>a.id===e);r&&(r.dismissed=!0,localStorage.setItem(NOTIFICATION_STORAGE_KEY,JSON.stringify(s)),this.emitNotificationEvent(r))}clearAll(){localStorage.setItem(NOTIFICATION_STORAGE_KEY,JSON.stringify([])),this.emitNotificationEvent(null)}getUnreadCount(){return this.getStoredNotifications().filter(e=>!e.read&&!e.dismissed).length}loadPreferences(){try{const e=localStorage.getItem(PREFERENCES_STORAGE_KEY);if(e)return f(f({},DEFAULT_PREFERENCES),JSON.parse(e))}catch(e){console.error("Error loading notification preferences:",e)}return DEFAULT_PREFERENCES}savePreferences(e){e&&(this.preferences=f(f({},this.preferences),e)),localStorage.setItem(PREFERENCES_STORAGE_KEY,JSON.stringify(this.preferences)),this.emitNotificationEvent(null)}getPreferences(){return f({},this.preferences)}getDefaultIcon(e){return`data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">${TYPE_ICONS[e]}</text></svg>`}emitNotificationEvent(e){window.dispatchEvent(new CustomEvent("skycrop:notification",{detail:{notification:e,count:this.getUnreadCount()}}))}initialize(){return y(this,null,function*(){this.getPermission()==="granted"&&!this.preferences.enabled&&(this.preferences.enabled=!0,this.savePreferences()),yield this.processQueue()})}}const notificationService=new NotificationService;notificationService.initialize().catch(console.error);const NotificationBell=({onClick:t,isOpen:e})=>{const[s,r]=reactExports.useState(0);return reactExports.useEffect(()=>{r(notificationService.getUnreadCount());const a=()=>{r(notificationService.getUnreadCount())};return window.addEventListener("skycrop:notification",a),()=>{window.removeEventListener("skycrop:notification",a)}},[]),jsxRuntimeExports.jsxs("button",{type:"button",onClick:t,className:`
        relative inline-flex items-center justify-center
        h-9 w-9 rounded-md
        transition-colors
        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2
        ${e?"bg-gray-100 text-gray-900":"text-gray-700 hover:bg-gray-50"}
      `,"aria-label":`Notifications${s>0?` (${s} unread)`:""}`,children:[jsxRuntimeExports.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),s>0&&jsxRuntimeExports.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center h-5 w-5 text-xs font-bold text-white bg-red-500 rounded-full",children:s>9?"9+":s})]})},NotificationCenter=({isOpen:t,onClose:e})=>{const[s,r]=reactExports.useState([]),a=useNavigate(),o=reactExports.useRef(null);reactExports.useEffect(()=>{t&&r(notificationService.getStoredNotifications())},[t]),reactExports.useEffect(()=>{const d=()=>{r(notificationService.getStoredNotifications())};return window.addEventListener("skycrop:notification",d),()=>{window.removeEventListener("skycrop:notification",d)}},[]),reactExports.useEffect(()=>{if(!t)return;const d=h=>{o.current&&!o.current.contains(h.target)&&e()};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[t,e]),reactExports.useEffect(()=>{if(!t)return;const d=h=>{h.key==="Escape"&&e()};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[t,e]);const c=d=>{notificationService.markAsRead(d.id),d.url?(a(d.url),e()):d.fieldId&&(a(`/fields/${d.fieldId}`),e())},i=()=>{notificationService.markAllAsRead(),r(notificationService.getStoredNotifications())},n=()=>{confirm("Clear all notifications?")&&(notificationService.clearAll(),r([]))},l=(d,h)=>{d.stopPropagation(),notificationService.dismissNotification(h),r(notificationService.getStoredNotifications())},u=s.filter(d=>!d.dismissed),m=u.filter(d=>!d.read).length;return t?jsxRuntimeExports.jsxs("div",{ref:o,className:"absolute right-0 top-12 z-50 w-96 max-w-[calc(100vw-2rem)] rounded-lg border border-gray-200 bg-white shadow-xl",role:"dialog","aria-label":"Notification center",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 py-3",children:[jsxRuntimeExports.jsxs("h2",{className:"text-sm font-semibold text-gray-900",children:["Notifications",m>0&&jsxRuntimeExports.jsxs("span",{className:"ml-2 inline-flex items-center rounded-full bg-blue-100 px-2 py-0.5 text-xs font-medium text-blue-800",children:[m," new"]})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:u.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:i,className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",children:"Mark all read"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:n,className:"text-xs text-gray-500 hover:text-gray-700 hover:underline",children:"Clear all"})]})})]}),jsxRuntimeExports.jsx("div",{className:"max-h-[480px] overflow-y-auto",children:u.length===0?jsxRuntimeExports.jsxs("div",{className:"px-4 py-12 text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-4xl mb-3",children:"ðŸ””"}),jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No notifications"}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"You're all caught up!"})]}):jsxRuntimeExports.jsx("div",{className:"divide-y divide-gray-100",children:u.map(d=>jsxRuntimeExports.jsx(NotificationItem,{notification:d,onClick:()=>c(d),onDismiss:h=>l(h,d.id)},d.id))})}),u.length>0&&jsxRuntimeExports.jsx("div",{className:"border-t border-gray-200 px-4 py-3 text-center",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{a("/settings/notifications"),e()},className:"text-xs text-blue-600 hover:text-blue-700 hover:underline",children:"Notification settings"})})]}):null},NotificationItem=({notification:t,onClick:e,onDismiss:s})=>{const r=()=>({"health-alert":"ðŸš¨","weather-warning":"ðŸŒ§ï¸",recommendation:"ðŸ¤–","yield-update":"ðŸ“Š",system:"âš™ï¸",general:"ðŸ“°"})[t.type]||"ðŸ“¬",a=()=>{const c={critical:"bg-red-50 border-l-4 border-l-red-500",high:"bg-orange-50 border-l-4 border-l-orange-500",medium:"bg-blue-50 border-l-4 border-l-blue-500",low:"bg-gray-50 border-l-4 border-l-gray-300"};return c[t.priority]||c.low},o=c=>{const n=Date.now()-c,l=Math.floor(n/6e4),u=Math.floor(n/36e5),m=Math.floor(n/864e5);return l<1?"Just now":l<60?`${l}m ago`:u<24?`${u}h ago`:m<7?`${m}d ago`:new Date(c).toLocaleDateString()};return jsxRuntimeExports.jsx("div",{onClick:e,className:`
        relative px-4 py-3 cursor-pointer transition-colors
        hover:bg-gray-50
        ${t.read?"bg-white":a()}
      `,children:jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[jsxRuntimeExports.jsx("div",{className:"text-2xl flex-shrink-0",children:r()}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2",children:[jsxRuntimeExports.jsx("p",{className:`text-sm font-medium ${t.read?"text-gray-700":"text-gray-900"}`,children:t.title}),jsxRuntimeExports.jsx("button",{type:"button",onClick:s,className:"text-gray-400 hover:text-gray-600 flex-shrink-0","aria-label":"Dismiss notification",children:jsxRuntimeExports.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),jsxRuntimeExports.jsx("p",{className:"mt-1 text-xs text-gray-600 line-clamp-2",children:t.body}),jsxRuntimeExports.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-gray-500",children:[jsxRuntimeExports.jsx("span",{children:o(t.timestamp)}),!t.read&&jsxRuntimeExports.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-blue-500","aria-label":"Unread"})]})]})]})})},PageLoader=({message:t="Loading..."})=>jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-gray-200 border-t-brand-blue",role:"status","aria-label":t,children:jsxRuntimeExports.jsx("span",{className:"sr-only",children:t})}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 font-medium",children:t}),jsxRuntimeExports.jsxs("div",{className:"mt-8 w-full max-w-2xl space-y-3 animate-pulse",children:[jsxRuntimeExports.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),jsxRuntimeExports.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),jsxRuntimeExports.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})]})}),API_URL=env.API_BASE_URL.replace("/api/v1","");class WebSocketService{constructor(){g(this,"socket",null);g(this,"token",null);g(this,"isConnecting",!1);g(this,"reconnectAttempts",0);g(this,"maxReconnectAttempts",5);g(this,"subscribedFields",new Set);g(this,"eventCallbacks",new Map)}connect(e){return y(this,null,function*(){var s;if((s=this.socket)!=null&&s.connected){console.log("[WebSocket] Already connected");return}if(this.isConnecting){console.log("[WebSocket] Connection already in progress");return}if(!e){console.warn("[WebSocket] No authentication token available");return}this.token=e,this.isConnecting=!0;try{console.log("[WebSocket] Connecting to",API_URL),this.socket=lookup(API_URL,{auth:{token:this.token},transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:this.maxReconnectAttempts}),this._setupEventListeners(),this.isConnecting=!1}catch(r){throw console.error("[WebSocket] Connection failed:",r),this.isConnecting=!1,r}})}disconnect(){this.socket&&(console.log("[WebSocket] Disconnecting"),this.socket.disconnect(),this.socket=null,this.subscribedFields.clear(),this.eventCallbacks.clear())}isConnected(){var e,s;return(s=(e=this.socket)==null?void 0:e.connected)!=null?s:!1}subscribeToField(e){var s;if(!((s=this.socket)!=null&&s.connected)){console.warn("[WebSocket] Not connected, cannot subscribe to field");return}console.log("[WebSocket] Subscribing to field:",e),this.socket.emit("subscribe_field",e),this.subscribedFields.add(e)}unsubscribeFromField(e){var s;(s=this.socket)!=null&&s.connected&&(console.log("[WebSocket] Unsubscribing from field:",e),this.socket.emit("unsubscribe_field",e),this.subscribedFields.delete(e))}on(e,s){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,new Set),this.eventCallbacks.get(e).add(s),this.socket&&this.socket.on(e,s)}off(e,s){const r=this.eventCallbacks.get(e);r&&(r.delete(s),r.size===0&&this.eventCallbacks.delete(e)),this.socket&&this.socket.off(e,s)}_resubscribeToFields(){var e;!((e=this.socket)!=null&&e.connected)||this.subscribedFields.size===0||(console.log("[WebSocket] Resubscribing to",this.subscribedFields.size,"fields"),this.subscribedFields.forEach(s=>{var r;(r=this.socket)==null||r.emit("subscribe_field",s)}))}_reattachEventListeners(){this.socket&&this.eventCallbacks.forEach((e,s)=>{e.forEach(r=>{this.socket.on(s,r)})})}_setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{var e;console.log("[WebSocket] Connected, Socket ID:",(e=this.socket)==null?void 0:e.id),this.reconnectAttempts=0,this._resubscribeToFields(),this._reattachEventListeners(),this._triggerCallbacks("connect",{})}),this.socket.on("disconnect",e=>{console.log("[WebSocket] Disconnected:",e),this._triggerCallbacks("disconnect",{reason:e})}),this.socket.on("connect_error",e=>{console.error("[WebSocket] Connection error:",e.message),this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts&&console.error("[WebSocket] Max reconnect attempts reached"),this._triggerCallbacks("connect_error",{error:e})}),this.socket.on("health_updated",e=>{console.log("[WebSocket] Health updated:",e),this._triggerCallbacks("health_updated",e)}),this.socket.on("health_alert",e=>{console.log("[WebSocket] Health alert:",e),this._triggerCallbacks("health_alert",e)}),this.socket.on("recommendations_updated",e=>{console.log("[WebSocket] Recommendations updated:",e),this._triggerCallbacks("recommendations_updated",e)}),this.socket.on("recommendation_created",e=>{console.log("[WebSocket] Recommendation created:",e),this._triggerCallbacks("recommendation_created",e)}),this.socket.on("yield_prediction_ready",e=>{console.log("[WebSocket] Yield prediction ready:",e),this._triggerCallbacks("yield_prediction_ready",e)}),this.socket.on("subscribed",e=>{console.log("[WebSocket] Subscribed to field:",e.fieldId),this._triggerCallbacks("subscribed",e)}),this.socket.on("unsubscribed",e=>{console.log("[WebSocket] Unsubscribed from field:",e.fieldId),this._triggerCallbacks("unsubscribed",e)}))}_triggerCallbacks(e,s){const r=this.eventCallbacks.get(e);r&&r.forEach(a=>{try{a(s)}catch(o){console.error(`[WebSocket] Error in ${e} callback:`,o)}})}}const websocketService=new WebSocketService,NotificationsContext=reactExports.createContext(void 0),NotificationsProvider=({children:t})=>{const[e,s]=reactExports.useState([]),{showToast:r}=useToast(),a=e.filter(u=>!u.read).length,o=reactExports.useCallback(u=>{const m=p(f({},u),{id:`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`});s(d=>[m,...d].slice(0,50))},[]),c=reactExports.useCallback(u=>{s(m=>m.map(d=>d.id===u?p(f({},d),{read:!0}):d))},[]),i=reactExports.useCallback(()=>{s(u=>u.map(m=>p(f({},m),{read:!0})))},[]),n=reactExports.useCallback(()=>{s([])},[]);reactExports.useEffect(()=>{const u=x=>{var E,v;o({type:"health",title:"Field Health Updated",message:`${x.fieldName}: Health score ${((E=x.health)==null?void 0:E.score)||"N/A"} (${((v=x.health)==null?void 0:v.status)||"unknown"})`,timestamp:new Date().toISOString(),read:!1,fieldId:x.fieldId,fieldName:x.fieldName})},m=x=>{var E;o({type:"alert",title:`${((E=x.severity)==null?void 0:E.toUpperCase())||"ALERT"}: Field Health Alert`,message:`${x.fieldName}: ${x.message}`,timestamp:new Date().toISOString(),read:!1,fieldId:x.fieldId,fieldName:x.fieldName,priority:x.severity==="critical"?"high":"medium"}),x.severity==="critical"&&r({variant:"error",title:"Critical Field Health Alert",description:`${x.fieldName}: ${x.message}`})},d=x=>{var E;o({type:"recommendation",title:"New Recommendations",message:`${x.fieldName}: ${x.message}`,timestamp:new Date().toISOString(),read:!1,fieldId:x.fieldId,fieldName:x.fieldName,priority:(E=x.recommendations)!=null&&E.some(v=>v.priority==="critical")?"high":"medium"})},h=x=>{o({type:"yield",title:"Yield Prediction Ready",message:`${x.fieldName}: ${x.message}`,timestamp:new Date().toISOString(),read:!1,fieldId:x.fieldId,fieldName:x.fieldName})},j=x=>{x.reason!=="io client disconnect"&&o({type:"system",title:"Connection Lost",message:"Real-time updates temporarily unavailable",timestamp:new Date().toISOString(),read:!1})},b=()=>{o({type:"system",title:"Connected",message:"Real-time updates enabled",timestamp:new Date().toISOString(),read:!1})};return websocketService.on("health_updated",u),websocketService.on("health_alert",m),websocketService.on("recommendation_created",d),websocketService.on("yield_prediction_ready",h),websocketService.on("disconnect",j),websocketService.on("connect",b),()=>{websocketService.off("health_updated",u),websocketService.off("health_alert",m),websocketService.off("recommendation_created",d),websocketService.off("yield_prediction_ready",h),websocketService.off("disconnect",j),websocketService.off("connect",b)}},[o,r]);const l={notifications:e,unreadCount:a,addNotification:o,markAsRead:c,markAllAsRead:i,clearAll:n};return jsxRuntimeExports.jsx(NotificationsContext.Provider,{value:l,children:t})},UiContext=reactExports.createContext(void 0),UI_STORAGE_KEY="skycrop_ui_prefs",getDefaultState=()=>({currentFieldId:void 0,defaultHealthIndex:"NDVI",defaultHealthRange:"30d"}),loadInitialState=()=>{var t,e;if(typeof window=="undefined")return getDefaultState();try{const s=window.localStorage.getItem(UI_STORAGE_KEY);if(!s)return getDefaultState();const r=JSON.parse(s);return{currentFieldId:r.currentFieldId,defaultHealthIndex:(t=r.defaultHealthIndex)!=null?t:"NDVI",defaultHealthRange:(e=r.defaultHealthRange)!=null?e:"30d"}}catch(s){return getDefaultState()}},persistState=t=>{if(typeof window!="undefined")try{window.localStorage.setItem(UI_STORAGE_KEY,JSON.stringify(t))}catch(e){}},UiProvider=({children:t})=>{const[e,s]=reactExports.useState(()=>loadInitialState()),r=reactExports.useCallback(i=>{s(n=>{const l=p(f({},n),{currentFieldId:i});return persistState(l),l})},[]),a=reactExports.useCallback(i=>{s(n=>{const l=p(f({},n),{defaultHealthIndex:i});return persistState(l),l})},[]),o=reactExports.useCallback(i=>{s(n=>{const l=p(f({},n),{defaultHealthRange:i});return persistState(l),l})},[]),c=reactExports.useMemo(()=>({state:e,setCurrentField:r,setHealthIndex:a,setHealthRange:o}),[e,r,a,o]);return jsxRuntimeExports.jsx(UiContext.Provider,{value:c,children:t})},useUiState=()=>{const t=reactExports.useContext(UiContext);if(!t)throw new Error("useUiState must be used within a UiProvider");return t},Modal=({isOpen:t,onClose:e,title:s,children:r})=>{const a=reactExports.useRef(null),o=reactExports.useRef(null),c=reactExports.useId();return reactExports.useEffect(()=>{if(!t||typeof document=="undefined")return;o.current=document.activeElement;const i=a.current;(()=>{if(!i)return;const u=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", "),m=Array.from(i.querySelectorAll(u)).filter(d=>!d.hasAttribute("data-focus-guard"));m.length>0?m[0].focus():i.focus()})();const l=u=>{if(u.key==="Escape"){u.stopPropagation(),e();return}if(u.key!=="Tab"||!i)return;const m=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", "),d=Array.from(i.querySelectorAll(m)).filter(x=>!x.hasAttribute("data-focus-guard"));if(d.length===0)return;const h=d[0],j=d[d.length-1],b=document.activeElement;u.shiftKey?(!b||b===h)&&(u.preventDefault(),j.focus()):(!b||b===j)&&(u.preventDefault(),h.focus())};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l),o.current&&o.current.focus&&o.current.focus()}},[t,e]),!t||typeof document=="undefined"?null:ReactDOM.createPortal(jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 px-4 py-6",onClick:e,children:jsxRuntimeExports.jsxs("div",{ref:a,role:"dialog","aria-modal":"true","aria-labelledby":s?c:void 0,className:clsx("w-full max-w-lg rounded-lg bg-white shadow-xl outline-none","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2"),tabIndex:-1,onClick:i=>i.stopPropagation(),children:[s&&jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between border-b border-gray-100 px-4 py-3",children:[jsxRuntimeExports.jsx("h2",{id:c,className:"text-sm font-semibold text-gray-900",children:s}),jsxRuntimeExports.jsx("button",{type:"button",onClick:e,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","aria-label":"Close dialog",children:"Ã—"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4 text-sm text-gray-800",children:r})]})}),document.body)};export{ApiError as A,Button as B,Card as C,ErrorState as E,FieldBoundaryLayer as F,LoadingState as L,Modal as M,NotificationBell as N,PageContainer as P,ToastProvider as T,UiProvider as U,adminKeys as a,useUiState as b,configureAuthHandlers as c,dashboardKeys as d,useOnlineStatus as e,fieldKeys as f,useMapCenter as g,httpClient as h,BaseMap as i,MapControls as j,calculatePolygonCenter as k,calculatePolygonArea as l,healthKeys as m,normalizeApiError as n,useBreadcrumbs as o,Breadcrumbs as p,FieldMapView as q,recommendationKeys as r,setAuthTokens as s,NotificationCenter as t,useToast as u,PageLoader as v,weatherKeys as w,NotificationsProvider as x,yieldKeys as y,notificationService as z};
