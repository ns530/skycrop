var ze=Object.defineProperty,Le=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var ie=(t,s,a)=>s in t?ze(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,Y=(t,s)=>{for(var a in s||(s={}))ne.call(s,a)&&ie(t,a,s[a]);if(H)for(var a of H(s))le.call(s,a)&&ie(t,a,s[a]);return t},q=(t,s)=>Le(t,Ee(s));var de=(t,s)=>{var a={};for(var l in t)ne.call(t,l)&&s.indexOf(l)<0&&(a[l]=t[l]);if(t!=null&&H)for(var l of H(t))s.indexOf(l)<0&&le.call(t,l)&&(a[l]=t[l]);return a};var w=(t,s,a)=>new Promise((l,r)=>{var i=d=>{try{n(a.next(d))}catch(m){r(m)}},c=d=>{try{n(a.throw(d))}catch(m){r(m)}},n=d=>d.done?l(d.value):Promise.resolve(d.value).then(i,c);n((a=a.apply(t,s)).next())});import{h as I,n as $,f as B,C as p,d as Be,b as M,L as J,E as Z,B as x,u as U,e as ye,M as Ie,g as $e,i as fe,j as pe,k as Ye,F as Me,l as Oe}from"./shared-BOarZger.js";import{u as X,c as V,d as R,j as e,f as O,r as v,g as je,M as Ue,h as Re}from"./react-vendor-CXQW5CXM.js";import{Y as He,u as qe,a as Ke,b as Ve,c as We,d as Qe}from"./feature-yield-Cwk_lcbu.js";import{L as be,m as Ge,a as Je,b as Ze}from"./map-vendor--2Gvwj5Q.js";const Xe="modulepreload",et=function(t){return"/"+t},ce={},tt=function(s,a,l){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),n=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(a.map(d=>{if(d=et(d),d in ce)return;ce[d]=!0;const m=d.endsWith(".css"),N=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${N}`))return;const h=document.createElement("link");if(h.rel=m?"stylesheet":Xe,m||(h.as="script"),h.crossOrigin="",h.href=d,n&&h.setAttribute("nonce",n),document.head.appendChild(h),m)return new Promise((S,A)=>{h.addEventListener("load",S),h.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(c){const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=c,window.dispatchEvent(n),!n.defaultPrevented)throw c}return r.then(c=>{for(const n of c||[])n.status==="rejected"&&i(n.reason);return s().catch(i)})},W=t=>{var r;const s=(r=t.center)==null?void 0:r.coordinates,[a,l]=Array.isArray(s)&&s.length>=2?[s[0],s[1]]:[void 0,void 0];return{id:t.field_id,name:t.name,areaHa:t.area_sqm/1e4,createdAt:t.created_at,updatedAt:t.updated_at,status:t.status,centroidLatLon:typeof l=="number"&&typeof a=="number"?{lat:l,lon:a}:void 0,geometry:t.boundary,latestHealthStatus:void 0,latestHealthIndex:void 0,latestRecommendationSummary:void 0}},st=t=>{const n=W(t),{geometry:a,latestHealthStatus:l,latestHealthIndex:r,latestRecommendationSummary:i}=n;return de(n,["geometry","latestHealthStatus","latestHealthIndex","latestRecommendationSummary"])},at=t=>{if(!t)return;const s={};return typeof t.page=="number"&&(s.page=t.page),typeof t.pageSize=="number"&&(s.page_size=t.pageSize),t.search&&(s.search=t.search),t.sort&&(s.sort=t.sort),t.order&&(s.order=t.order),s},ve=t=>w(void 0,null,function*(){try{const s=yield I.get("/fields",{params:at(t)}),{data:a,pagination:l,meta:r}=s.data;return{data:a.map(st),pagination:{page:l.page,pageSize:l.page_size,total:l.total},meta:r}}catch(s){throw $(s)}}),Ne=t=>w(void 0,null,function*(){try{const s=yield I.get(`/fields/${t}`);return W(s.data.data)}catch(s){throw $(s)}}),we=t=>w(void 0,null,function*(){try{const s={name:t.name,boundary:t.geometry,crop_type:t.cropType,notes:t.notes},a=yield I.post("/fields",s);return W(a.data.data)}catch(s){throw $(s)}}),Se=(t,s)=>w(void 0,null,function*(){try{const a={};s.name!==void 0&&(a.name=s.name),s.status!==void 0&&(a.status=s.status),s.cropType!==void 0&&(a.crop_type=s.cropType),s.notes!==void 0&&(a.notes=s.notes),s.geometry!==void 0&&(a.boundary=s.geometry);const l=yield I.patch(`/fields/${t}`,a);return W(l.data.data)}catch(a){throw $(a)}}),Fe=t=>w(void 0,null,function*(){try{yield I.delete(`/fields/${t}`)}catch(s){throw $(s)}}),ee=(t,s)=>w(void 0,null,function*(){try{return(yield I.post(`/fields/${t}/detect-boundary`,s)).data.data}catch(a){throw $(a)}}),rt=Object.freeze(Object.defineProperty({__proto__:null,createField:we,deleteField:Fe,detectFieldBoundary:ee,getFieldById:Ne,listFields:ve,updateField:Se},Symbol.toStringTag,{value:"Module"})),it=t=>X({queryKey:B.list(t),queryFn:()=>ve(t),staleTime:6e4,placeholderData:s=>s}),Ce=t=>X({queryKey:B.detail(t),queryFn:()=>Ne(t),enabled:!!t}),_e=()=>{const t=V();return R({mutationFn:s=>we(s),onSuccess:()=>{t.invalidateQueries({queryKey:B.all})}})},Ae=t=>{const s=V();return R({mutationFn:a=>Se(t,a),onSuccess:a=>{s.setQueryData(B.detail(t),a),s.invalidateQueries({queryKey:B.all})}})},nt=()=>{const t=V();return R({mutationFn:({fieldId:s})=>Fe(s),onMutate:a=>w(void 0,[a],function*({fieldId:s}){yield t.cancelQueries({queryKey:B.all});const l=t.getQueriesData({queryKey:B.all});return l.forEach(([r,i])=>{i&&t.setQueryData(r,q(Y({},i),{data:i.data.filter(c=>c.id!==s)}))}),{previousLists:l}}),onError:(s,a,l)=>{l&&l.previousLists.forEach(([r,i])=>{t.setQueryData(r,i)})},onSettled:()=>{t.invalidateQueries({queryKey:B.all})}})},lt=()=>{const t=V();return R({mutationFn:({fieldId:s,payload:a})=>ee(s,a),onSuccess:(s,{fieldId:a})=>{t.setQueryData(B.detail(a),l=>l&&q(Y({},l),{geometry:s}))}})},dt=({avgResponseTimeMs:t})=>{const a=(l=>l===null?"poor":l<=200?"excellent":l<=500?"fair":"poor")(t);return e.jsxs(p,{title:"API Performance",status:a,showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t!==null?`${t}ms`:"N/A"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Average response time â€¢ Last hour"}),t!==null&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t<=200?"Excellent performance":t<=500?"Good performance":"Needs optimization"})]})},ct=({assessments:t,available:s,highRiskCount:a})=>{const r=(i=>i===0?"excellent":i<=2?"fair":"poor")(a);return s?e.jsx(p,{title:"Disaster Assessment",status:r,showStatusStripe:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"High risk fields:"}),e.jsx("span",{className:"font-semibold",children:a})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total assessed:"}),e.jsx("span",{className:"font-semibold",children:t.length})]}),t.length>0&&e.jsx("div",{className:"mt-3 space-y-1",children:t.slice(0,3).map(i=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:[i.field_name,":"]}),e.jsx("span",{className:`font-semibold ${i.risk_level==="high"?"text-red-600":i.risk_level==="medium"?"text-yellow-600":"text-green-600"}`,children:i.risk_level})]},i.field_id))})]})}):e.jsx(p,{title:"Disaster Assessment",status:"poor",showStatusStripe:!0,children:e.jsx("p",{className:"text-sm text-gray-600",children:"Assessment not available"})})},ot=t=>e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-md font-semibold text-gray-900",children:"Disaster Assessment"}),e.jsx(ct,Y({},t))]}),mt=({ndvi:t,totalRecords:s})=>{const l=(r=>r===null?"poor":r>=.6?"excellent":r>=.4?"fair":"poor")(t);return e.jsxs(p,{title:"NDVI (Vegetation Index)",status:l,showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t!==null?t.toFixed(3):"N/A"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[s," measurements â€¢ Last 30 days"]}),t!==null&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t>=.6?"Healthy vegetation":t>=.4?"Moderate health":"Poor vegetation"})]})},xt=({ndwi:t,totalRecords:s})=>{const l=(r=>r===null?"poor":r<=-.2?"excellent":r<=0?"fair":"poor")(t);return e.jsxs(p,{title:"NDWI (Water Index)",status:l,showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t!==null?t.toFixed(3):"N/A"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[s," measurements â€¢ Last 30 days"]}),t!==null&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t<=-.2?"Low water stress":t<=0?"Moderate moisture":"High water content"})]})},ht=({uptimeHours:t})=>{const a=(i=>i>=168?"excellent":i>=24?"fair":"poor")(t),l=Math.floor(t/24),r=Math.floor(t%24);return e.jsxs(p,{title:"System Uptime",status:a,showStatusStripe:!0,children:[e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[l,"d ",r,"h"]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Continuous operation"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t>=168?"Excellent reliability":t>=24?"Good uptime":"Recent restart"})]})},ut=({tdvi:t,totalRecords:s})=>{const l=(r=>r===null?"poor":r<=.1?"excellent":r<=.2?"fair":"poor")(t);return e.jsxs(p,{title:"TDVI (Temperature Difference)",status:l,showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:t!==null?t.toFixed(3):"N/A"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[s," measurements â€¢ Last 30 days"]}),t!==null&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:t<=.1?"Low thermal stress":t<=.2?"Moderate stress":"High thermal stress"})]})},gt=({totalFields:t,totalAssessments:s,avgHealthScore:a,lastActivity:l,activeUsersToday:r,sessionDurationAvg:i})=>{const n=(d=>d===null?"poor":d>=70?"excellent":d>=50?"fair":"poor")(a);return e.jsx(p,{title:"User Analytics",status:n,showStatusStripe:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total fields:"}),e.jsx("span",{className:"font-semibold",children:t})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Assessments:"}),e.jsx("span",{className:"font-semibold",children:s})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Avg health score:"}),e.jsx("span",{className:"font-semibold",children:a!==null?`${a.toFixed(1)}%`:"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Active today:"}),e.jsx("span",{className:"font-semibold",children:r})]})]})})},yt=t=>e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-md font-semibold text-gray-900",children:"User Analytics"}),e.jsx(gt,Y({},t))]}),ft=({forecast:t,totals:s})=>{const l=(r=>r<10?"poor":r<50?"fair":"excellent")(s.rain_7d_mm);return e.jsx(p,{title:"7-Day Weather Forecast",status:l,showStatusStripe:!0,children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Next 7 days:"}),e.jsxs("span",{className:"font-semibold",children:[s.rain_7d_mm.toFixed(1),"mm rain"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Next 3 days:"}),e.jsxs("span",{className:"font-semibold",children:[s.rain_3d_mm.toFixed(1),"mm rain"]})]}),e.jsx("div",{className:"mt-3 space-y-1",children:t.slice(0,3).map((r,i)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["Day ",i+1,":"]}),e.jsxs("span",{children:[r.rain_mm.toFixed(1),"mm â€¢ ",r.tmin,"Â°-",r.tmax,"Â°C"]})]},r.date))})]})})},pt=({forecast:t,totals:s})=>e.jsxs("section",{className:"space-y-4",children:[e.jsx("h2",{className:"text-md font-semibold text-gray-900",children:"Weather Forecast"}),e.jsx(ft,{forecast:t,totals:s})]}),jt=()=>w(void 0,null,function*(){try{return(yield I.get("/dashboard/metrics")).data.data}catch(t){throw $(t)}}),bt=()=>X({queryKey:Be.metrics,queryFn:()=>jt(),staleTime:5*6e4,refetchOnWindowFocus:!1}),oe=()=>{const t=O(),{setCurrentField:s}=M(),{data:a,isLoading:l,error:r}=bt(),i=()=>{s(void 0),t("/fields/create")},c=()=>{t("/fields")},n=()=>{t("/weather")},d=g=>{t(`/fields/${g}`)},m=g=>g>=70?"excellent":g>=40?"fair":"poor",N=g=>{const _=new Date(g),u=Math.floor((new Date().getTime()-_.getTime())/(1e3*60*60));return u<24?u===0?"Just now":`${u}h ago`:`${Math.floor(u/24)}d ago`};if(l)return e.jsxs("section",{"aria-labelledby":"farmer-dashboard-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"farmer-dashboard-heading",className:"text-lg font-semibold text-gray-900",children:"Farmer dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading your farm overview..."})]}),e.jsx(J,{message:"Loading dashboard data..."})]});if(r)return e.jsxs("section",{"aria-labelledby":"farmer-dashboard-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"farmer-dashboard-heading",className:"text-lg font-semibold text-gray-900",children:"Farmer dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overview of your fields and recent activity."})]}),e.jsx(Z,{title:"Failed to load dashboard",message:"Unable to load your farm data. Please try again."})]});if(!a)return null;const{fields:h,health:S,alerts:A,recent_activity:k,field_thumbnails:f,vegetation_indices:y,system:j,weather_forecast:F,user_analytics:C,disaster_assessment:z}=a;return e.jsxs("section",{"aria-labelledby":"farmer-dashboard-heading",className:"space-y-6",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"farmer-dashboard-heading",className:"text-lg font-semibold text-gray-900",children:"Farmer dashboard"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Overview of your fields, recent health changes, and upcoming weather."})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(p,{title:"Fields monitored",status:"excellent",showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:h.total}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[h.active," active â€¢ ",h.total_area_hectares.toFixed(1)," ha total"]})]}),e.jsxs(p,{title:"Field health",status:m(S.average_score),showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:Math.round(S.average_score)}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[S.status_distribution.good+S.status_distribution.moderate," healthy fields"]})]}),e.jsxs(p,{title:"Active alerts",status:"fair",showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:A.total}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[A.by_severity.high," high priority â€¢ Last 7 days"]})]}),e.jsx(mt,{ndvi:y.ndvi,totalRecords:y.total_records}),e.jsx(xt,{ndwi:y.ndwi,totalRecords:y.total_records}),e.jsx(ut,{tdvi:y.tdvi,totalRecords:y.total_records}),e.jsx(ht,{uptimeHours:j.uptime_hours}),e.jsx(dt,{avgResponseTimeMs:j.api_performance.avg_response_time_ms}),e.jsxs(p,{title:"Recommendations",status:"excellent",showStatusStripe:!0,children:[e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:A.total}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[A.by_type.water," water â€¢ ",A.by_type.fertilizer," fertilizer"]})]})]}),f.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-md font-semibold text-gray-900",children:"Your Fields"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:f.map(g=>e.jsx(p,{title:g.field_name,className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>d(g.field_id),children:e.jsxs("div",{className:"space-y-3",children:[g.thumbnail_url?e.jsx("img",{src:g.thumbnail_url,alt:`Satellite view of ${g.field_name}`,className:"w-full h-32 object-cover rounded-md"}):e.jsx("div",{className:"w-full h-32 bg-gray-200 rounded-md flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 text-sm",children:"No image"})}),e.jsxs("div",{className:"text-xs text-gray-600",children:[g.area_hectares.toFixed(1)," hectares"]})]})},g.field_id))})]}),F.available&&e.jsx(pt,{forecast:F.forecast,totals:F.totals}),e.jsx(yt,{totalFields:C.total_fields,totalAssessments:C.total_assessments,avgHealthScore:C.avg_health_score,lastActivity:C.last_activity,activeUsersToday:C.active_users_today,sessionDurationAvg:C.session_duration_avg}),e.jsx(ot,{assessments:z.assessments,available:z.available,highRiskCount:z.high_risk_count}),f.length>0&&e.jsx(He,{request:{features:[{field_id:f[0].field_id,ndvi:.7,precipitation:120,temperature:25,soil_moisture:.6}]},fieldArea:f[0].area_hectares}),k.length>0&&e.jsx(p,{title:"Recent Activity",children:e.jsx("div",{className:"space-y-3",children:k.slice(0,5).map((g,_)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${g.type==="health_assessment"?"bg-green-500":"bg-blue-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900",children:g.type==="health_assessment"?`Health assessment: ${g.details.status} (${g.details.score})`:`Recommendation: ${g.details.type} (${g.details.severity})`}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g.field_name," â€¢ ",N(g.date)]})]})]},_))})}),e.jsx(p,{title:"Quick Actions",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"primary",onClick:i,children:"Add new field"}),e.jsx(x,{size:"sm",variant:"secondary",onClick:c,children:"View all fields"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:n,children:"Check weather"})]})})]})},zt=Object.freeze(Object.defineProperty({__proto__:null,DashboardPage:oe,default:oe},Symbol.toStringTag,{value:"Module"})),me=()=>{var D,u;const t=O(),{showToast:s}=U(),{state:{currentFieldId:a},setCurrentField:l}=M(),{isOnline:r}=ye(),[i,c]=v.useState(1),[n]=v.useState(10),{data:d,isLoading:m,isError:N,error:h,refetch:S,isFetching:A}=it({page:i,pageSize:n}),k=(D=d==null?void 0:d.data)!=null?D:[],f=d==null?void 0:d.pagination,y=!!d,j=v.useMemo(()=>f?f.page>1:i>1,[f,i]),F=v.useMemo(()=>{if(!f)return!1;const{page:o,pageSize:P,total:T}=f;return o*P<T},[f]),C=(o,P="")=>{l(o);const T=`/fields/${o}`;t(P?`${T}/${P}`:T)},z=()=>{l(void 0),t("/fields/create")},g=()=>w(void 0,null,function*(){var o;try{yield S()}catch(P){const T=h!=null?h:P;s({title:"Failed to load fields",description:(o=T==null?void 0:T.message)!=null?o:"Something went wrong while fetching fields.",variant:"error"})}}),_=o=>{var T;const P=a===o.id;return e.jsxs("tr",{className:P?"bg-blue-50/60 hover:bg-blue-50 text-gray-900":"hover:bg-gray-50 text-gray-900",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:o.name}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-700",children:[o.areaHa.toFixed(2)," ha"]}),e.jsxs("td",{className:"px-4 py-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"block",children:["Created: ",new Date(o.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"block",children:["Updated: ",new Date(o.updatedAt).toLocaleDateString()]})]}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-700",children:(T=o.status)!=null?T:"â€”"}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>C(o.id),children:"View"}),e.jsx(x,{size:"sm",variant:"primary",onClick:()=>C(o.id,"health"),children:"Health"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>C(o.id,"recommendations"),children:"Recommendations"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>C(o.id,"weather"),children:"Weather"})]})})]},o.id)};return e.jsxs("section",{"aria-labelledby":"fields-list-heading",className:"space-y-4",children:[e.jsxs("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{id:"fields-list-heading",className:"text-lg font-semibold text-gray-900",children:"Your fields"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your registered fields, jump into health maps, and open recommendations."})]}),e.jsx(x,{size:"sm",variant:"primary",onClick:z,children:"Add field"})]}),!r&&e.jsxs("p",{className:"flex items-center gap-2 text-xs text-amber-700",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-500","aria-hidden":"true"}),y?"You are offline. Showing the last loaded data.":"You are offline and have no cached data yet."]}),e.jsxs(p,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-100 text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Name"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Area"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Activity"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[m&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center",children:e.jsx(J,{compact:!0,message:"Loading fieldsâ€¦"})})}),!m&&N&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center",children:e.jsx(Z,{compact:!0,title:"Unable to load your fields",message:(u=h==null?void 0:h.message)!=null?u:"Something went wrong while fetching fields.",onRetry:g})})}),!m&&!N&&k.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-sm text-gray-500",children:`You haven't added any fields yet. Use the "Add field" button to register your first field.`})}),!m&&!N&&k.map(_)]})]})}),e.jsxs("footer",{className:"mt-4 flex items-center justify-between gap-3 border-t border-gray-100 pt-3 text-xs text-gray-600",children:[e.jsx("div",{children:f?e.jsxs("span",{children:["Page ",f.page," Â· Showing ",k.length," of ",f.total," fields"]}):e.jsx("span",{children:A?"Refreshing fieldsâ€¦":"Fields list"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>c(o=>Math.max(1,o-1)),disabled:!j||m||A,children:"Previous"}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>c(o=>o+1),disabled:!F||m||A,children:"Next"})]})]})]})]})},Lt=Object.freeze(Object.defineProperty({__proto__:null,FieldsListPage:me,default:me},Symbol.toStringTag,{value:"Module"})),te=({mode:t,initialValue:s,onSubmit:a,isSubmitting:l=!1,onCancel:r})=>{var k,f;const[i,c]=v.useState({name:"",cropType:"",notes:""}),[n,d]=v.useState({});v.useEffect(()=>{var y,j,F;s&&c({name:(y=s.name)!=null?y:"",cropType:(j=s.cropType)!=null?j:"",notes:(F=s.notes)!=null?F:""})},[s]);const m=y=>{const j={};return!y.name||y.name.trim().length===0?j.name="Field name is required.":y.name.trim().length<2?j.name="Field name should be at least 2 characters.":y.name.trim().length>100&&(j.name="Field name should be shorter than 100 characters."),d(j),Object.keys(j).length===0},N=y=>j=>{const F=q(Y({},i),{[y]:j.target.value});c(F),y==="name"&&n.name&&m(F)},h=y=>w(void 0,null,function*(){var F,C;y.preventDefault(),m(i)&&(yield a({name:i.name.trim(),cropType:((F=i.cropType)==null?void 0:F.trim())||void 0,notes:((C=i.notes)==null?void 0:C.trim())||void 0}))}),S=t==="create"?"Create field":"Edit field details",A=t==="create"?"Save field":"Save changes";return e.jsx(p,{title:S,className:"max-w-xl",children:e.jsxs("form",{onSubmit:h,className:"space-y-4",noValidate:!0,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"field-name",className:"block text-sm font-medium text-gray-900",children:"Field name"}),e.jsx("input",{id:"field-name",name:"name",type:"text",required:!0,value:i.name,onChange:N("name"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-brand-blue focus:outline-none focus:ring-1 focus:ring-brand-blue","aria-invalid":!!n.name,"aria-describedby":n.name?"field-name-error":void 0}),n.name&&e.jsx("p",{id:"field-name-error",className:"mt-1 text-xs text-status-poor",children:n.name}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Choose a short, descriptive name to identify this field on maps and reports."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"field-crop-type",className:"block text-sm font-medium text-gray-900",children:"Crop type (optional)"}),e.jsx("input",{id:"field-crop-type",name:"cropType",type:"text",value:(k=i.cropType)!=null?k:"",onChange:N("cropType"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-brand-blue focus:outline-none focus:ring-1 focus:ring-brand-blue",placeholder:"e.g., Rice, Maize"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This helps tailor health indices and recommendations to the correct crop."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"field-notes",className:"block text-sm font-medium text-gray-900",children:"Notes (optional)"}),e.jsx("textarea",{id:"field-notes",name:"notes",rows:4,value:(f=i.notes)!=null?f:"",onChange:N("notes"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-900 shadow-sm focus:border-brand-blue focus:outline-none focus:ring-1 focus:ring-brand-blue",placeholder:"Add any notes about access, irrigation, or local context."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Notes are for your reference only and are not used directly by ML models yet."})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-2 border-t border-gray-100 mt-2",children:[r&&e.jsx(x,{type:"button",size:"sm",variant:"secondary",onClick:r,disabled:l,children:"Cancel"}),e.jsx(x,{type:"submit",size:"sm",variant:"primary",disabled:l,children:l?"Savingâ€¦":A})]})]})})},xe=()=>{var se,ae,re;const{fieldId:t}=je(),s=O(),{showToast:a}=U(),{state:{currentFieldId:l},setCurrentField:r}=M(),{isOnline:i}=ye(),c=t!=null?t:"";v.useEffect(()=>{t&&r(t)},[t,r]);const{data:n,isLoading:d,isError:m,error:N,refetch:h,isFetching:S}=Ce(c),{mutateAsync:A,isPending:k}=Ae(c),{mutateAsync:f,isPending:y}=nt(),{data:j,isLoading:F}=qe(c),{mutateAsync:C,isPending:z}=Ke(),[g,_]=v.useState(!1),[D,u]=v.useState(!1),[o,P]=v.useState(!1),T=b=>w(void 0,null,function*(){var L;try{yield A({name:b.name,cropType:b.cropType,notes:b.notes}),_(!1),a({title:"Field updated",description:"Your field details were saved successfully.",variant:"success"})}catch(E){const G=(L=E==null?void 0:E.message)!=null?L:"Failed to update field details.";a({title:"Could not update field",description:G,variant:"error"})}}),ke=()=>w(void 0,null,function*(){var b;if(n)try{yield f({fieldId:n.id}),u(!1),l===n.id&&r(void 0),a({title:"Field deleted",description:"The field has been deleted. Historical analytics may still be available separately.",variant:"success"}),s("/fields")}catch(L){const E=(b=L==null?void 0:L.message)!=null?b:"Failed to delete field.";a({title:"Could not delete field",description:E,variant:"error"})}}),Q=b=>{n&&(r(n.id),s(`/fields/${n.id}/${b}`))},De=b=>w(void 0,null,function*(){var L;if(n)try{yield C({fieldId:n.id,harvestDate:b.harvestDate,actualYieldKgPerHa:b.actualYieldKgPerHa,totalYieldKg:b.totalYieldKg,notes:b.notes}),P(!1),a({title:"Yield data saved",description:"Your harvest yield has been recorded successfully.",variant:"success"})}catch(E){const G=(L=E==null?void 0:E.message)!=null?L:"Failed to save yield data.";a({title:"Could not save yield data",description:G,variant:"error"})}});if(!t)return e.jsxs("section",{"aria-labelledby":"field-detail-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"field-detail-heading",className:"text-lg font-semibold text-gray-900",children:"Field not found"}),e.jsx("p",{className:"text-sm text-gray-600",children:"The requested field could not be identified from the URL. Please return to your fields list and try again."})]}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>s("/fields"),children:"Back to fields"})]});if(d&&!n)return e.jsxs("section",{"aria-labelledby":"field-detail-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"field-detail-heading",className:"text-lg font-semibold text-gray-900",children:"Loading fieldâ€¦"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fetching the latest details for your field."})]}),e.jsx(J,{message:"Loading field summaryâ€¦"})]});if(m&&!n)return e.jsxs("section",{"aria-labelledby":"field-detail-heading",className:"space-y-4",children:[e.jsx("header",{className:"space-y-1",children:e.jsx("h1",{id:"field-detail-heading",className:"text-lg font-semibold text-gray-900",children:"Unable to load field"})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(Z,{title:"Unable to load field",message:(se=N==null?void 0:N.message)!=null?se:"Something went wrong while loading this field. Please try again."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>h(),children:"Retry"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>s("/fields"),children:"Back to fields"})]})]})]});if(!n)return null;const Pe=l===n.id,Te={name:n.name,cropType:void 0,notes:void 0};return e.jsxs("section",{"aria-labelledby":"field-detail-heading",className:"space-y-4",children:[e.jsxs("header",{className:"flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{id:"field-detail-heading",className:"text-lg font-semibold text-gray-900",children:n.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed view for this field. Use the actions below to edit details, manage its boundary, or explore health, recommendations, and weather insights."}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:["Area: ",n.areaHa.toFixed(2)," ha"]}),e.jsxs("span",{children:["Status: ",(ae=n.status)!=null?ae:"â€”"]}),e.jsxs("span",{children:["Created: ",new Date(n.createdAt).toLocaleDateString()]}),e.jsxs("span",{children:["Updated: ",new Date(n.updatedAt).toLocaleDateString()]}),!i&&e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-700",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-amber-500","aria-hidden":"true"}),"Offline â€“ showing last loaded data"]}),Pe&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-blue-50 px-2 py-0.5 text-[11px] font-medium text-blue-700",children:"Current field"}),S&&e.jsx("span",{children:"Refreshingâ€¦"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 sm:mt-0",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>_(b=>!b),children:g?"Cancel editing":"Edit details"}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>s(`/fields/${n.id}/edit-boundary`),children:"Edit boundary"}),e.jsx(x,{size:"sm",variant:"destructive",onClick:()=>u(!0),disabled:y,children:"Delete field"})]})]}),e.jsx(p,{title:"Summary",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"This summary shows key information about your field. Boundary visualizations and health overlays will appear on the map in map-first views."}),e.jsxs("dl",{className:"grid grid-cols-1 gap-3 text-xs text-gray-600 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Area"}),e.jsxs("dd",{children:[n.areaHa.toFixed(2)," hectares"]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Status"}),e.jsx("dd",{children:(re=n.status)!=null?re:"Not specified"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Created"}),e.jsx("dd",{children:new Date(n.createdAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Last updated"}),e.jsx("dd",{children:new Date(n.updatedAt).toLocaleString()})]})]})]})}),e.jsx(p,{title:"Quick actions",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"primary",onClick:()=>Q("health"),children:"View health"}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>Q("recommendations"),children:"View recommendations"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>Q("weather"),children:"View weather"})]})}),e.jsx(p,{title:"Harvest Yield",children:o?e.jsx(Ve,{fieldId:n.id,fieldAreaHa:n.areaHa,predictedYieldKgPerHa:4500,onSubmit:De,onCancel:()=>P(!1),isSubmitting:z}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"After each harvest, record your actual yield to help improve future predictions and track your field's performance over time."}),e.jsx(x,{size:"sm",variant:"primary",onClick:()=>P(!0),className:"w-full sm:w-auto",children:"ðŸŒ¾ Log Harvest Yield"})]})}),j&&j.length>1&&e.jsx(We,{records:j,showPredictions:!0}),j&&j.length>0&&e.jsx(Qe,{records:j.map(b=>({id:b.id,harvestDate:b.harvestDate,predictedYieldKgPerHa:b.predictedYieldKgPerHa,actualYieldKgPerHa:b.actualYieldKgPerHa,totalYieldKg:b.totalYieldKg,accuracy:b.accuracy,notes:b.notes,createdAt:b.createdAt})),isLoading:F,fieldAreaHa:n.areaHa}),e.jsx(p,{title:g?"Edit field details":"Details form",children:g?e.jsx(te,{mode:"edit",initialValue:Te,onSubmit:T,isSubmitting:k}):e.jsx("p",{className:"text-sm text-gray-600",children:"Use the Edit details button above to update the name or notes for this field. Additional metadata such as crop type can be incorporated as the backend schema evolves."})}),e.jsx(Ie,{isOpen:D,onClose:()=>u(!1),title:"Delete field",children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-800",children:[e.jsxs("p",{children:["You are about to delete the field"," ",e.jsxs("span",{className:"font-semibold",children:['"',n.name,'"']}),". This action cannot be undone."]}),e.jsx("p",{className:"text-xs text-gray-600",children:"Historical analytics or exported data that referenced this field may remain available separately, but the field will no longer appear in your active list."}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>u(!1),disabled:y,children:"Cancel"}),e.jsx(x,{size:"sm",variant:"destructive",onClick:ke,disabled:y,children:y?"Deletingâ€¦":"Delete field"})]})]})})]})},Et=Object.freeze(Object.defineProperty({__proto__:null,FieldDetailPage:xe,default:xe},Symbol.toStringTag,{value:"Module"})),vt={type:"Polygon",coordinates:[[[0,0],[0,1e-4],[1e-4,1e-4],[1e-4,0],[0,0]]]},he=()=>{const t=O(),{showToast:s}=U(),{setCurrentField:a}=M(),{mutateAsync:l,isPending:r}=_e(),i=n=>w(void 0,null,function*(){var d;try{const m=yield l({name:n.name,cropType:n.cropType,notes:n.notes,geometry:vt});a(m.id),s({title:"Field created",description:"Your field was created successfully. You can now edit its boundary on the map.",variant:"success"}),t(`/fields/${m.id}`)}catch(m){const N=(d=m==null?void 0:m.message)!=null?d:"Failed to create field. Please try again.";s({title:"Could not create field",description:N,variant:"error"})}}),c=()=>{t("/fields")};return e.jsxs("section",{"aria-labelledby":"create-field-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"create-field-heading",className:"text-lg font-semibold text-gray-900",children:"Add new field"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Provide basic details for your field. You will be able to refine its boundary on the map afterwards."})]}),e.jsx(p,{children:e.jsx(te,{mode:"create",onSubmit:i,isSubmitting:r,onCancel:c})})]})},Bt=Object.freeze(Object.defineProperty({__proto__:null,CreateFieldPage:he,default:he},Symbol.toStringTag,{value:"Module"}));delete be.Icon.Default.prototype._getIconUrl;be.Icon.Default.mergeOptions({iconUrl:Ze,iconRetinaUrl:Je,shadowUrl:Ge});function Nt({onLocationSelected:t}){return Re({click(s){t({lat:s.latlng.lat,lng:s.latlng.lng})}}),null}const wt=({onLocationConfirmed:t,onCancel:s})=>{const{center:a,getUserLocation:l}=$e(),[r,i]=v.useState(null),c=()=>{r&&t(r)};return e.jsxs("div",{className:"flex flex-col h-screen bg-white",children:[e.jsx("header",{className:"bg-brand-blue text-white p-4 shadow-md",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold mb-1",children:"Step 1: Select Field Location"}),e.jsx("p",{className:"text-sm text-white/90",children:"Tap the center of your field on the satellite map"}),e.jsx("p",{className:"text-xs text-white/70 mt-1",children:"ðŸ’¡ Tip: Zoom in for better accuracy"})]}),e.jsx(x,{onClick:s,variant:"secondary",size:"sm",className:"shrink-0",children:"Cancel"})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs(fe,{center:[a.lat,a.lng],zoom:14,children:[e.jsx(Nt,{onLocationSelected:i}),r&&e.jsx(Ue,{position:[r.lat,r.lng]}),e.jsx(pe,{onCenterOnUser:l})]}),!r&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-[1000] bg-white/95 backdrop-blur-sm rounded-lg shadow-lg px-4 py-3 pointer-events-none",children:e.jsx("p",{className:"text-sm text-gray-700 text-center",children:"ðŸ‘† Tap on the map to select your field location"})})]}),r&&e.jsx("footer",{className:"bg-white border-t shadow-lg",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-green-900 mb-1",children:"âœ“ Location Selected"}),e.jsxs("p",{className:"text-xs text-gray-600 font-mono",children:[r.lat.toFixed(6),", ",r.lng.toFixed(6)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:c,className:"flex-1",size:"lg",children:"Confirm & Detect Boundary"}),e.jsx(x,{onClick:()=>i(null),variant:"secondary",size:"lg",children:"Clear"})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"After confirmation, our AI will detect your field boundary"})]})})]})},St=({progress:t,currentStep:s,estimatedTime:a})=>e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 px-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand-blue/10 rounded-full mb-3",children:e.jsx("span",{className:"text-3xl",children:"ðŸ›°ï¸"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-1",children:"Detecting Field Boundary"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Analyzing satellite imagery with AI"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"relative w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:"absolute inset-y-0 left-0 bg-gradient-to-r from-brand-blue to-blue-500 transition-all duration-500 ease-out rounded-full flex items-center justify-end pr-2",style:{width:`${t}%`},children:t>10&&e.jsxs("span",{className:"text-[10px] font-bold text-white drop-shadow",children:[Math.round(t),"%"]})})}),e.jsxs("p",{className:"text-center mt-2 text-xs font-medium text-gray-700",children:[Math.round(t),"% Complete"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 bg-blue-50 rounded-lg p-3",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-brand-blue border-t-transparent rounded-full"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:s})})]})}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Estimated time remaining:"," ",e.jsxs("span",{className:"font-semibold text-gray-900",children:[a,"s"]})]})}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsx(K,{label:"Retrieve satellite image",isComplete:t>25,isActive:t<=25}),e.jsx(K,{label:"Analyze field boundaries",isComplete:t>50,isActive:t>25&&t<=50}),e.jsx(K,{label:"Detect edges",isComplete:t>75,isActive:t>50&&t<=75}),e.jsx(K,{label:"Calculate area",isComplete:t>95,isActive:t>75&&t<=95})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-amber-900",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"})," This process usually takes 30-60 seconds. We're using satellite imagery from Sentinel to accurately detect your field boundaries."]})})]})}),K=({label:t,isComplete:s,isActive:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`
          shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-xs
          ${s?"bg-green-500 text-white":a?"bg-brand-blue text-white animate-pulse":"bg-gray-200 text-gray-400"}
        `,children:s?"âœ“":a?"â—":"â—‹"}),e.jsx("p",{className:`
          text-xs
          ${s?"text-green-700 font-medium":a?"text-gray-900 font-medium":"text-gray-500"}
        `,children:t})]}),Ft=({boundary:t,area:s,onConfirm:a,onAdjust:l,onCancel:r})=>{const i=Ye(t),c={id:"temp-preview",name:"Preview",boundary:t,area:s,healthStatus:"good"};return e.jsxs("div",{className:"flex flex-col h-screen bg-white",children:[e.jsx("header",{className:"bg-green-600 text-white p-4 shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-3xl",children:"âœ…"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold mb-1",children:"Boundary Detected Successfully!"}),e.jsx("p",{className:"text-sm text-white/90",children:"Review the detected boundary and area"})]})]})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsxs(fe,{center:[i.lat,i.lng],zoom:16,children:[e.jsx(Me,{fields:[c]}),e.jsx(pe,{showLocationButton:!1})]}),e.jsx("div",{className:"absolute top-4 left-4 right-4 z-[1000] bg-white/95 backdrop-blur-sm rounded-lg shadow-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-1",children:"Detected Area"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[s.toFixed(2),e.jsx("span",{className:"text-sm font-normal text-gray-600 ml-1",children:"hectares"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Confidence"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"85%"}})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:"85%"})]})]})]})}),e.jsx("div",{className:"absolute bottom-4 left-4 z-[1000] bg-white/95 backdrop-blur-sm rounded-lg shadow-lg px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded border-2 border-green-600 bg-green-600/30"}),e.jsx("p",{className:"text-xs text-gray-700",children:"Detected Boundary"})]})})]}),e.jsx("footer",{className:"bg-white border-t shadow-lg",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx(x,{onClick:a,className:"w-full",size:"lg",children:"âœ“ Confirm Boundary & Continue"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(x,{onClick:l,variant:"secondary",size:"md",disabled:!0,title:"Boundary editing coming soon",children:"âœï¸ Adjust Manually"}),e.jsx(x,{onClick:r,variant:"secondary",size:"md",children:"â†º Start Over"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-900",children:[e.jsx("strong",{children:"ðŸ’¡ Tip:"}),' The green boundary shows your detected field. If it looks accurate, click "Confirm" to proceed. You can adjust it manually later from the field details page.']})})]})})]})},Ct=({fieldId:t,location:s})=>{const[a,l]=v.useState({progress:0,currentStep:"Initializing...",estimatedTime:60}),r=R({mutationFn:()=>w(void 0,null,function*(){const d={bbox:[s.lng-.009,s.lat-.009,s.lng+.009,s.lat+.009]};return ee(t,d)})}),i=v.useCallback(()=>{let n=0,d;const m=[{at:0,step:"Retrieving satellite image...",time:60},{at:15,step:"Loading Sentinel-2 data...",time:50},{at:25,step:"Analyzing field boundaries...",time:45},{at:40,step:"Detecting crop patterns...",time:35},{at:50,step:"Identifying field edges...",time:30},{at:65,step:"Refining boundary...",time:20},{at:75,step:"Calculating area...",time:15},{at:85,step:"Validating results...",time:10},{at:95,step:"Finalizing...",time:5}];return d=setInterval(()=>{n+=1.5;const h=m.slice().reverse().find(S=>n>=S.at)||m[0];l({progress:Math.min(n,98),currentStep:h.step,estimatedTime:Math.max(0,Math.ceil(h.time*(1-n/100)))}),n>=98&&clearInterval(d)},500),()=>clearInterval(d)},[]);return{detect:v.useCallback(()=>w(void 0,null,function*(){l({progress:0,currentStep:"Initializing...",estimatedTime:60});const n=i();try{const d=yield r.mutateAsync();return l({progress:100,currentStep:"Complete!",estimatedTime:0}),n(),d}catch(d){throw n(),d}}),[r,i]),isDetecting:r.isPending,isSuccess:r.isSuccess,isError:r.isError,error:r.error,data:r.data,progress:a.progress,currentStep:a.currentStep,estimatedTime:a.estimatedTime}},_t={type:"Polygon",coordinates:[[[0,0],[0,1e-4],[1e-4,1e-4],[1e-4,0],[0,0]]]},ue=()=>{const t=O(),{showToast:s}=U(),{setCurrentField:a}=M(),[l,r]=v.useState("select-location"),[i,c]=v.useState(null),[n,d]=v.useState(null),[m,N]=v.useState(0),[h,S]=v.useState(null),{mutateAsync:A,isPending:k}=_e(),f=Ct({fieldId:h||"",location:i||{lat:0,lng:0}}),y=_=>w(void 0,null,function*(){var D;try{c(_);const u=yield A({name:`Field at ${_.lat.toFixed(4)}, ${_.lng.toFixed(4)}`,cropType:"paddy",notes:"Boundary being detected...",geometry:_t});S(u.id),r("detecting-boundary");const o=yield f.detect(),P=Oe(o);d(o),N(P),r("confirm-boundary"),s({title:"Boundary detected",description:`Field boundary detected successfully (${P.toFixed(2)} ha)`,variant:"success"})}catch(u){const o=(D=u==null?void 0:u.message)!=null?D:"Failed to detect boundary";s({title:"Boundary detection failed",description:o,variant:"error"}),r("select-location")}}),j=()=>{r("enter-details")},F=()=>{s({title:"Coming soon",description:"Manual boundary editing will be available in a future update.",variant:"default"})},C=()=>{r("select-location"),c(null),d(null),S(null)},z=_=>w(void 0,null,function*(){var D;if(!(!h||!n))try{const{updateField:u}=yield tt(()=>w(void 0,null,function*(){const{updateField:o}=yield Promise.resolve().then(()=>rt);return{updateField:o}}),void 0);yield u(h,{name:_.name,cropType:_.cropType,notes:_.notes,geometry:n}),a(h),s({title:"Field created successfully",description:`${_.name} has been added to your fields.`,variant:"success"}),t(`/fields/${h}`)}catch(u){const o=(D=u==null?void 0:u.message)!=null?D:"Failed to save field details";s({title:"Save failed",description:o,variant:"error"})}}),g=()=>{t("/fields")};switch(l){case"select-location":return e.jsx(wt,{onLocationConfirmed:y,onCancel:g});case"detecting-boundary":return e.jsx(St,{progress:f.progress,currentStep:f.currentStep,estimatedTime:f.estimatedTime});case"confirm-boundary":return n?e.jsx(Ft,{boundary:n,area:m,onConfirm:j,onAdjust:F,onCancel:C}):null;case"enter-details":return e.jsx("section",{"aria-labelledby":"field-details-heading",className:"min-h-screen bg-gray-50 py-6 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("h1",{id:"field-details-heading",className:"text-2xl font-semibold text-gray-900 mb-2",children:"Almost Done! ðŸŽ‰"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Boundary detected successfully. Now give your field a name and add details."})]}),e.jsxs(p,{children:[e.jsx(te,{mode:"create",onSubmit:z,isSubmitting:k,onCancel:g}),e.jsx("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-green-900",children:[e.jsx("strong",{children:"âœ“ Detected Area:"})," ",m.toFixed(2)," hectares"]})})]})]})});default:return null}},It=Object.freeze(Object.defineProperty({__proto__:null,CreateFieldWithMapPage:ue,default:ue},Symbol.toStringTag,{value:"Module"})),ge=()=>{var _;const{fieldId:t}=je(),s=O(),{showToast:a}=U(),{setCurrentField:l}=M(),r=t!=null?t:"";v.useEffect(()=>{t&&l(t)},[t,l]);const{data:i,isLoading:c,isError:n,error:d,refetch:m,isFetching:N}=Ce(r),{mutateAsync:h,isPending:S}=lt(),{mutateAsync:A,isPending:k}=Ae(r),[f,y]=v.useState();v.useEffect(()=>{i!=null&&i.geometry&&y(i.geometry)},[i==null?void 0:i.geometry]);const j=()=>w(void 0,null,function*(){var D;if(i)try{const u=yield h({fieldId:i.id,payload:{}});y(u),a({title:"AI boundary detected",description:"An AI-generated boundary has been applied in this panel. The visual polygon will appear once the map is integrated.",variant:"success"})}catch(u){const o=(D=u==null?void 0:u.message)!=null?D:"Failed to detect boundary using AI. Your existing boundary has been preserved.";a({title:"Boundary detection failed",description:o,variant:"error"})}}),F=()=>{i!=null&&i.geometry&&(y(i.geometry),a({title:"Boundary reset",description:"Reverted to the last saved boundary for this field.",variant:"default"}))},C=()=>w(void 0,null,function*(){var D;if(i)try{yield A({geometry:f!=null?f:i.geometry}),a({title:"Boundary saved",description:"The field boundary was saved successfully.",variant:"success"}),s(`/fields/${i.id}`)}catch(u){const o=(D=u==null?void 0:u.message)!=null?D:"Failed to save the boundary. Please try again.";a({title:"Could not save boundary",description:o,variant:"error"})}});return t?c&&!i?e.jsxs("section",{"aria-labelledby":"edit-boundary-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"edit-boundary-heading",className:"text-lg font-semibold text-gray-900",children:"Loading boundaryâ€¦"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fetching the latest details and boundary for your field."})]}),e.jsx(p,{children:e.jsx("p",{className:"text-sm text-gray-600",children:"Loading boundary informationâ€¦"})})]}):n&&!i?e.jsxs("section",{"aria-labelledby":"edit-boundary-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"edit-boundary-heading",className:"text-lg font-semibold text-gray-900",children:"Unable to load field boundary"}),e.jsx("p",{className:"text-sm text-gray-600",children:(_=d==null?void 0:d.message)!=null?_:"Something went wrong while loading this field. Please try again."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>m(),children:"Retry"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>s(`/fields/${t}`),children:"Back to field details"})]})]}):i?e.jsxs("section",{"aria-labelledby":"edit-boundary-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"edit-boundary-heading",className:"text-lg font-semibold text-gray-900",children:"Edit field boundary"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use the controls in this side panel to manage your field boundary. The map on the left will host the interactive drawing tools and overlays in a future iteration."}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Field: ",e.jsx("span",{className:"font-medium text-gray-900",children:i.name})," Â· Area:"," ",i.areaHa.toFixed(2)," ha ",N&&"Â· Refreshingâ€¦"]})]}),e.jsx(p,{title:"Boundary summary",children:e.jsxs("div",{className:"space-y-3 text-sm text-gray-700",children:[e.jsx("p",{children:"This boundary defines the area used for health indices, recommendations, and weather aggregation. Adjustments here will affect downstream analytics once saved."}),e.jsxs("dl",{className:"grid grid-cols-1 gap-3 text-xs text-gray-600 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Area"}),e.jsxs("dd",{children:[i.areaHa.toFixed(2)," hectares"]})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"font-medium text-gray-900",children:"Current boundary source"}),e.jsx("dd",{children:"Manual or previously saved geometry (AI-generated boundaries will be noted here in future iterations)."})]})]})]})}),e.jsxs(p,{title:"AI boundary detection",className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"SkyCrop can use satellite imagery and ML models to suggest a field boundary. The detected polygon will be applied as the working boundary in this panel. A future update will render the detected shape directly on the map."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"primary",onClick:j,disabled:S,children:S?"Analyzingâ€¦":"Detect boundary with AI"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This may take a few seconds while satellite imagery is analyzed."})]})]}),e.jsxs(p,{title:"Manual boundary controls",className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"Manual drawing and editing tools will appear on the map to the left. For now, these controls let you reset to the last saved boundary and persist any AI-detected boundary to the backend."}),e.jsxs("ol",{className:"list-decimal pl-5 text-xs text-gray-600 space-y-1",children:[e.jsx("li",{children:"Use the map tools (coming soon) to draw or adjust the field boundary."}),e.jsx("li",{children:"Use Detect boundary with AI above to propose a boundary from imagery."}),e.jsx("li",{children:"Review the suggested boundary on the map, then click Save boundary to persist."})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(x,{size:"sm",variant:"secondary",onClick:F,disabled:k,children:"Reset to original boundary"}),e.jsx(x,{size:"sm",variant:"primary",onClick:C,disabled:k||!f,children:k?"Savingâ€¦":"Save boundary"}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>s(`/fields/${i.id}`),disabled:k||S,children:"Back to field details"})]})]})]}):null:e.jsxs("section",{"aria-labelledby":"edit-boundary-heading",className:"space-y-4",children:[e.jsxs("header",{className:"space-y-1",children:[e.jsx("h1",{id:"edit-boundary-heading",className:"text-lg font-semibold text-gray-900",children:"Field not found"}),e.jsx("p",{className:"text-sm text-gray-600",children:"The requested field could not be identified from the URL. Please return to your fields list and try again."})]}),e.jsx(x,{size:"sm",variant:"secondary",onClick:()=>s("/fields"),children:"Back to fields"})]})},$t=Object.freeze(Object.defineProperty({__proto__:null,EditFieldBoundaryPage:ge,default:ge},Symbol.toStringTag,{value:"Module"}));export{Bt as C,zt as D,$t as E,Lt as F,tt as _,Et as a,It as b,Ce as u};
