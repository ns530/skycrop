# Story 1.3: Migrate to React Query v5

## Status
Draft

## Story

**As a** Frontend Developer,
**I want** to migrate the SkyCrop frontend from React Query v4 patterns to v5,
**so that** we benefit from the latest features and maintain compatibility.

## Acceptance Criteria

1. All React Query v4 deprecated APIs are updated to v5 equivalents
2. keepPreviousData is replaced with placeholderData
3. cacheTime is replaced with gcTime
4. QueryClient is properly configured for v5
5. All existing functionality continues to work
6. No breaking changes to user experience
7. Migration maintains <5s load times by optimizing query configurations and reducing unnecessary re-renders
8. Offline capability is enhanced, utilizing React Query v5's improved offline data persistence and synchronization features
9. Accessibility is preserved, with error states and loading indicators remaining intuitive for low-literacy farmers
10. Mobile-first design is maintained, ensuring query optimizations support responsive data loading on limited connectivity

## Tasks / Subtasks

- [ ] Analyze current React Query usage
  - [ ] Find all uses of keepPreviousData
  - [ ] Find all uses of cacheTime
  - [ ] Identify other v4 patterns that need updating
- [ ] Update QueryClient configuration
  - [ ] Configure default options for v5
  - [ ] Set appropriate gcTime values
- [ ] Migrate keepPreviousData to placeholderData
  - [ ] Update all hook usages in feature directories
  - [ ] Test pagination and data loading behavior
- [ ] Update cacheTime to gcTime
  - [ ] Update all query configurations
  - [ ] Verify caching behavior is maintained
- [ ] Test React Query functionality
  - [ ] Verify data fetching works correctly
  - [ ] Test error handling and retries
  - [ ] Confirm caching and invalidation work

## Dev Notes

### Relevant Source Tree Info
- QueryClient setup: `frontend/src/app/providers/AppProviders.tsx`
- Query keys: `frontend/src/shared/query/queryKeys.ts`
- Feature hooks: `frontend/src/features/*/hooks/`
- React Query version: 5.59.0 in package.json

### Testing Standards
- Test all data fetching hooks work correctly
- Verify pagination and infinite scroll functionality
- Test error states and loading states
- Confirm background refetching works
- Run existing test suites to ensure no regressions

### Technical Context
- React Query v5 has breaking changes from v4
- keepPreviousData → placeholderData for better UX
- cacheTime → gcTime for clearer naming
- Default staleTime changed from 0 to 5 minutes
- Improved error handling and retry logic
- Performance: Migration must optimize for <5s load times, leveraging v5's efficient caching and background updates
- Offline: React Query v5 enhances offline support with better persistence and synchronization capabilities
- Accessibility: Ensure loading states and error messages remain accessible and user-friendly for low-literacy users
- Mobile-first: Configure queries to handle limited connectivity and support responsive data loading

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | BMad Master |

## Dev Agent Record

### Agent Model Used
x-ai/grok-code-fast-1

### Debug Log References
- N/A

### Completion Notes List
- N/A

### File List
- N/A

## QA Results
- N/A