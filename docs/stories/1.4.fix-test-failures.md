# Story 1.4: Fix Test Suite Failures

## Status
Draft

## Story

**As a** Frontend Developer,
**I want** to fix all 11 failed Jest test suites in the SkyCrop frontend,
**so that** the test suite provides reliable feedback on code quality and prevents regressions.

## Acceptance Criteria

1. All 11 failed Jest test suites pass
2. `npm test` runs successfully without failures
3. Test failures due to missing AuthProvider wrappers are resolved
4. React Query API changes are properly mocked in tests
5. Test coverage is maintained or improved
6. Test fixes maintain <5s load times by ensuring no performance regressions in test execution
7. Offline capability is tested, covering offline state management and cached data display
8. Accessibility is tested, including ARIA attributes, focus management, and low-literacy user interactions
9. Mobile-first design is tested, with responsive component behavior and touch target compliance

## Tasks / Subtasks

- [ ] Analyze test failures
  - [ ] Run `npm test` to identify specific failing suites
  - [ ] Categorize failures (AuthProvider missing, React Query changes, etc.)
- [ ] Fix AuthProvider wrapper issues
  - [ ] Add AuthProvider to test setups
  - [ ] Configure test environment with required providers
- [ ] Update React Query mocks for v5
  - [ ] Fix keepPreviousData/ placeholderData in tests
  - [ ] Update cacheTime/gcTime in test mocks
- [ ] Fix test configuration issues
  - [ ] Update Jest configuration if needed
  - [ ] Fix import/ module resolution issues
- [ ] Verify test suite passes
  - [ ] Run full test suite
  - [ ] Confirm all tests pass
  - [ ] Check test coverage reports

## Dev Notes

### Relevant Source Tree Info
- Jest config: `frontend/jest.config.cjs`
- Test files: `frontend/src/**/*.test.{ts,tsx}`
- Test setup: `frontend/src/test/setupTests.ts`
- Auth provider: `frontend/src/features/auth/context/AuthContext.tsx`
- React Query setup: `frontend/src/app/providers/AppProviders.tsx`

### Testing Standards
- Use React Testing Library for component tests
- Mock external dependencies (API calls, routing)
- Test user interactions and accessibility
- Maintain 80% code coverage goal
- Follow arrange-act-assert pattern

### Technical Context
- Jest 29.7.0 with jsdom environment
- React Testing Library 16.0.0
- MSW (Mock Service Worker) configured for API mocking
- Tests failing due to missing context providers
- React Query v5 changes affecting test mocks
- Performance: Tests must not introduce overhead that impacts <5s load time goals in CI/CD
- Offline: Include tests for useOnlineStatus hook and offline data display
- Accessibility: Test jsx-a11y compliance and focus management for low-literacy users
- Mobile-first: Test responsive design and touch interactions using RTL

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-17 | 1.0 | Initial story creation | BMad Master |

## Dev Agent Record

### Agent Model Used
x-ai/grok-code-fast-1

### Debug Log References
- N/A

### Completion Notes List
- N/A

### File List
- N/A

## QA Results
- N/A